{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Verse Agent Loop Configuration",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "配置版本"
    },
    "loop": {
      "type": "object",
      "properties": {
        "max_tasks": {
          "type": "integer",
          "minimum": 1,
          "description": "完成多少个需求后停止"
        },
        "auto_generate_requirements": {
          "type": "boolean",
          "description": "需求队列空时自动生成新需求"
        },
        "requirement_queue_threshold": {
          "type": "integer",
          "minimum": 0,
          "description": "需求队列低于此数量时触发生成"
        },
        "escalation_threshold": {
          "type": "integer",
          "minimum": 1,
          "description": "连续否决多少次后升级到人工"
        }
      }
    },
    "compile": {
      "type": "object",
      "properties": {
        "max_attempts": {
          "type": "integer",
          "minimum": 1,
          "description": "编译最大尝试次数"
        },
        "verse_cli_path": {
          "type": "string",
          "description": "verse-cli 路径"
        }
      }
    },
    "review": {
      "type": "object",
      "properties": {
        "weights": {
          "type": "object",
          "properties": {
            "utility": { "type": "number", "minimum": 0, "maximum": 1 },
            "framework": { "type": "number", "minimum": 0, "maximum": 1 },
            "quality": { "type": "number", "minimum": 0, "maximum": 1 }
          },
          "description": "评审权重 (总和应为1)"
        },
        "pass_threshold": {
          "type": "number",
          "minimum": 1,
          "maximum": 10,
          "description": "通过分数阈值"
        },
        "require_no_critical": {
          "type": "boolean",
          "description": "是否要求无严重问题"
        }
      }
    },
    "tactician": {
      "type": "object",
      "properties": {
        "calibration_frequency": {
          "type": "integer",
          "minimum": 1,
          "description": "校准模式下调用频率（每N个需求）"
        },
        "auto_frequency": {
          "type": "integer",
          "minimum": 1,
          "description": "全自动模式下调用频率（每N个需求）"
        },
        "skip_if_no_updates": {
          "type": "boolean",
          "description": "无更新时跳过调用"
        }
      }
    },
    "agent": {
      "type": "object",
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["copilot", "openai"],
          "description": "Agent提供者"
        },
        "model": {
          "type": "string",
          "description": "模型名称"
        },
        "timeout": {
          "type": "integer",
          "minimum": 30,
          "description": "调用超时时间（秒）"
        },
        "retry_attempts": {
          "type": "integer",
          "minimum": 0,
          "description": "重试次数"
        },
        "api_key_env": {
          "type": "string",
          "description": "API密钥环境变量名"
        }
      }
    },
    "git": {
      "type": "object",
      "properties": {
        "auto_commit": {
          "type": "boolean",
          "description": "自动提交更改"
        },
        "branch_prefix": {
          "type": "string",
          "description": "分支名前缀"
        },
        "main_branch": {
          "type": "string",
          "description": "主分支名"
        }
      }
    },
    "logs": {
      "type": "object",
      "properties": {
        "active_limit": {
          "type": "integer",
          "minimum": 1,
          "description": "活跃日志保留数量"
        },
        "archive_by": {
          "type": "string",
          "enum": ["month", "week"],
          "description": "归档方式"
        }
      }
    }
  }
}
