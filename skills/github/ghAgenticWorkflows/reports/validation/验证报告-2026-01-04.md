# 简化版科研系统 - 验证报告

> **验证日期**: 2026-01-04
> **验证人**: GitHub Copilot (Claude Opus 4.5)
> **状态**: ⚠️ 部分成功

---

## 验证结果摘要

| 步骤 | 预期结果 | 实际结果 | 状态 |
|------|----------|----------|------|
| 编译 Workflow | 无错误 | 无错误无警告 | ✅ 成功 |
| 触发 Workflow | 成功触发 | 成功触发 | ✅ 成功 |
| 创建 Issue | Issue 创建并包含正确模板 | Issue #71 成功创建 | ✅ 成功 |
| 分配给 Copilot | Issue assignees 包含 copilot | assignees 为空 | ⚠️ 失败 |
| Copilot 执行 | 自动创建 PR | 待验证 | ⏳ 待定 |

---

## 详细记录

### 1. 编译阶段

**命令**:

```bash
gh aw compile research-planner
```

**结果**:

```
✓ .github\workflows\research-planner.md (391.1 KB)
✓ Compiled 1 workflow(s): 0 error(s), 0 warning(s)
```

**修复历史**:

1. 初始版本使用 `engine: claude`，运行时报错缺少 `CLAUDE_CODE_OAUTH_TOKEN`
2. 改为 `engine: copilot`，无需额外 API key
3. 初始版本包含 `permissions: issues: write`，在 strict 模式下被拒绝
4. 移除 `issues: write`，只保留 `issues: read`

### 2. 运行阶段

**命令**:

```bash
gh aw run research-planner \
  -f topic="测试任务 - 验证 Research Planner 功能" \
  -f output_path="docs/research/test-validation.md"
```

**Run ID**: 20693062405

**Jobs 执行结果**:

- ✅ activation (5s)
- ✅ agent (1m4s)
- ✅ detection (23s)
- ✅ safe_outputs (11s)
- ✅ conclusion (6s)

### 3. Issue 创建

**Issue #71**: `[Research] 测试任务 - 验证 Research Planner 功能`

**标签**: `research-task`, `copilot-task` ✅

**内容**: 包含完整的调研模板 ✅

### 4. 分配给 Copilot

**问题**: `assign_to_agent` 验证失败

**错误信息**:

```
assign_to_agent 'issue_number' must be a valid positive integer (got: aw_test1234abcd)
```

**原因分析**:

- `create-issue` 返回临时 ID (`aw_test1234abcd`)
- `assign-to-agent` 需要真正的 Issue 编号（如 `71`）
- 两者之间缺少关联机制

**替代方案**:

1. 使用 `create-agent-task` 替代（需要 `COPILOT_GITHUB_TOKEN`）
2. 手动分配给 Copilot：`gh issue edit 71 --add-assignee @copilot`
3. 依赖 `copilot-task` 标签触发 Copilot 自动响应

---

## 已知限制

| 限制 | 说明 | 解决方案 |
|------|------|----------|
| `assign-to-agent` 需要真实 Issue 编号 | 无法在同一 workflow 中自动关联 | 使用 `create-agent-task` |
| `create-agent-task` 需要 PAT | 需要配置 `COPILOT_GITHUB_TOKEN` secret | 配置仓库 secret |
| `engine: claude` 需要 API key | 需要 `ANTHROPIC_API_KEY` 或 `CLAUDE_CODE_OAUTH_TOKEN` | 使用 `engine: copilot` |

---

## 建议的后续步骤

### 方案 A: 配置 PAT (推荐)

1. 创建 GitHub PAT，权限包含 `contents:write`, `issues:write`, `pull-requests:write`
2. 添加为仓库 secret：`COPILOT_GITHUB_TOKEN`
3. 修改 workflow 使用 `create-agent-task` 替代 `create-issue` + `assign-to-agent`

### 方案 B: 手动分配 (临时方案)

1. Issue 创建后手动执行：

   ```bash
   gh issue edit <number> --add-assignee @copilot
   ```

2. 或在 GitHub 网页上手动分配

### 方案 C: 依赖标签触发

1. 为仓库配置 Copilot 自动响应 `copilot-task` 标签的 Issue
2. 不需要显式分配

---

## 参考链接

- [Workflow Run](https://github.com/TeamFlint-Dev/vibe-coding-cn/actions/runs/20693062405)
- [Issue #71](https://github.com/TeamFlint-Dev/vibe-coding-cn/issues/71)
- [MVP 设计文档](简化版科研系统-MVP.md)
