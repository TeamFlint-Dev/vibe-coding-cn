## H003: repo-memory 的 file-glob 是安全边界设计

**状态**: `proposed`

**提出者**: workflow-case-study (Run #25)  
**提出日期**: 2026-01-09  
**最后更新**: 2026-01-09

---

### 观察依据

在 `metrics-collector` 的 frontmatter 中看到：

```yaml
tools:
  repo-memory:
    branch-name: memory/meta-orchestrators
    file-glob: "metrics/**"
```

**关键观察**：
1. `file-glob: "metrics/**"` 限制了 repo-memory 只能访问 `metrics/` 目录下的文件
2. 即使工作流尝试写入其他路径（如 `campaigns/` 或 `alerts/`），也会被阻止
3. 这类似于文件系统权限中的 **chroot** 机制

**设计动机猜测**：
- **防止误操作**：collector 不应该修改其他 orchestrator 的数据
- **职责隔离**：每个工作流只能访问自己负责的数据范围
- **安全边界**：即使 Prompt 被注入攻击，也无法越界访问

---

### 猜想陈述

**我认为**: `repo-memory` 的 `file-glob` 参数不仅是文件过滤功能，更是一种**安全边界设计** - 通过限制工作流只能访问特定路径，防止误操作和越权访问。

**类比**：
- **Unix chroot**: 限制进程只能访问特定目录树
- **Docker volume mount**: 限制容器只能访问挂载的路径
- **repo-memory file-glob**: 限制工作流只能访问匹配的文件

---

### 验证标准

**证实条件** (满足任一):
- [ ] 找到 2+ 个使用 `file-glob` 限制访问范围的案例
- [ ] 测试：工作流尝试访问 `file-glob` 之外的路径会被拒绝
- [ ] 找到官方文档说明 `file-glob` 的安全性用途

**证伪条件** (满足任一):
- [ ] 证明 `file-glob` 只是便利功能，没有安全强制
- [ ] 找到工作流成功绕过 `file-glob` 限制的案例
- [ ] 官方文档说明 `file-glob` 仅用于性能优化

**边界探索**:
- `file-glob` 是否支持多个模式？（如 `["metrics/**", "alerts/**"]`）
- 如果不配置 `file-glob`，是否可以访问所有文件？
- `file-glob` 的匹配规则是什么？（支持正则表达式吗？）

---

### 证据链

| 日期 | 贡献者 | 类型 | 摘要 | 权重 |
|------|--------|------|------|------|
| 2026-01-09 | workflow-case-study #25 | support | metrics-collector 使用 `file-glob: "metrics/**"` 限制访问 | +1 |

**证据统计**: 支持 1 / 反例 0 / 边界 0

---

### 当前结论

证据不足，仅有一个观察案例。需要：
1. **查找其他使用 `file-glob` 的工作流**，确认是否都用于限制访问范围
2. **实验验证**：测试工作流是否真的无法访问 `file-glob` 之外的路径
3. **查阅文档**：确认 `file-glob` 的设计初衷（性能 vs 安全）

**下一步建议**：
- 搜索 gh-aw 仓库中所有 `file-glob` 的使用案例
- 查阅 `repo-memory` 工具的文档或源码
- 设计测试用例验证访问边界

---

### 关联猜想

| 关系 | 猜想 | 说明 |
|------|------|------|
| - | - | 暂无关联猜想 |

---

### 备注

**如果猜想证实**，这将是一个重要的**安全最佳实践**：
- 所有使用 `repo-memory` 的工作流都应该配置 `file-glob`
- 不同职责的工作流应该访问不同的路径范围
- 可以创建一个检查规则：警告没有 `file-glob` 的 repo-memory 配置

**如果猜想证伪**（仅是便利功能）：
- `file-glob` 仍然有价值（减少不必要的文件操作）
- 但不能依赖它作为安全边界
- 需要通过 Prompt 约束来防止误操作

**相关问题**：
- `repo-memory` 是否有其他安全机制？（如权限检查、审计日志）
- 是否有跨工作流访问 repo-memory 的案例？
