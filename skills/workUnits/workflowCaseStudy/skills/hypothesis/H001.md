## H001: 生产者-消费者分离原则

**状态**: `proposed`

**提出者**: workflow-case-study (Run #25)
**提出日期**: 2026-01-09  
**最后更新**: 2026-01-09

---

### 观察依据

在分析 `metrics-collector` 工作流时，发现它采用了明确的职责分离设计：
- Collector（生产者）只负责数据采集和存储，Prompt 中明确禁止分析（"DO NOT analyze or interpret the metrics"）
- Analyzer（消费者）只负责读取和分析数据，不进行采集
- 通过 `repo-memory` 解耦，collector 写入 `metrics/daily/*.json` 和 `metrics/latest.json`，analyzer 读取

**依赖关系**：
```
metrics-collector (Producer)
    ↓ (repo-memory/metrics/)
    ├→ agent-performance-analyzer (Consumer)
    ├→ campaign-manager (Consumer)  
    └→ workflow-health-manager (Consumer)
```

---

### 猜想陈述

**我认为**: 在构建 Meta-Orchestrator 生态时，将数据采集（Producer）和数据分析（Consumer）分离到不同的工作流中，可以显著降低系统复杂度和 API 查询成本。

**核心收益**：
1. **避免重复查询**：如果 3 个 analyzer 各自查询 120 个工作流，共需 360 次查询；使用 shared collector 只需 120 次
2. **降低耦合**：分析器变更不影响收集器，反之亦然
3. **提高可靠性**：收集失败不影响分析（使用历史数据），分析失败不影响收集
4. **支持时间旅行**：保留 30 天历史，可以回溯分析趋势

---

### 验证标准

**证实条件** (满足任一):
- [ ] 找到 2+ 个使用 Producer-Consumer 分离的成功案例（当前已有 1 个：metrics-collector）
- [ ] 计算：shared collector vs 独立查询的 API 调用量差异 > 50%
- [ ] 找到官方文档或最佳实践推荐此模式

**证伪条件** (满足任一):
- [ ] 找到成功的 Meta-Orchestrator 生态不使用 Producer-Consumer 分离
- [ ] 证明分离带来的复杂度超过收益（如维护成本过高）
- [ ] 发现 repo-memory 的性能瓶颈导致分离失效

**边界探索**:
- 多少个 Consumer 才值得引入专门的 Producer？（1个？3个？）
- 数据采集频率如何影响分离的价值？（每小时 vs 每天）
- 是否存在不适合分离的场景？（实时性要求极高？）

---

### 证据链

| 日期 | 贡献者 | 类型 | 摘要 | 权重 |
|------|--------|------|------|------|
| 2026-01-09 | workflow-case-study #25 | support | metrics-collector 成功实现 Producer-Consumer 分离 | +1 |

**证据统计**: 支持 1 / 反例 0 / 边界 0

---

### 当前结论

证据不足，仅有一个案例支持。需要：
1. 查找更多使用此模式的工作流（是否还有其他 collector？）
2. 计算具体的 API 调用量节省（量化收益）
3. 探索边界条件（何时需要分离，何时不需要）

**下一步建议**：
- 分析其他 Meta-Orchestrator，确认是否都依赖 metrics-collector
- 搜索是否还有其他类型的 collector（不仅仅是 metrics）

---

### 关联猜想

| 关系 | 猜想 | 说明 |
|------|------|------|
| `supports` | H002 | 如果 Producer-Consumer 分离成立，agentic-workflows 工具的元编程能力是实现 Producer 的基础 |

---

### 备注

**设计模式关联**：
- 现有模式库中的 "Shared Metrics Infrastructure Pattern" 已部分描述此模式
- 但未提炼出更通用的 Producer-Consumer 分离原则
- 建议：如果猜想证实，将其提炼为独立模式

**典型案例**：
- Producer: `metrics-collector`
- Consumers: `agent-performance-analyzer`, `campaign-manager`, `workflow-health-manager`
