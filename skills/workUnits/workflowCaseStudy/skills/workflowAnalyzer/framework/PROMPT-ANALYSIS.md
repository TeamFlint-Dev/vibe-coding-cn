# Prompt 设计分析指南

> **用途**: 系统化分析 GitHub Agentic Workflow 的 Prompt 设计质量  
> **来源**: workflowAnalyzer Skill

---

## 分析维度

| 维度 | 关注点 | 好的实践 |
|------|--------|---------|
| **角色定义** | 清晰的身份 | "你是 XXX 专家" |
| **任务分阶段** | Phase 划分 | 每个 Phase 有明确目标 |
| **上下文注入** | GitHub 变量 | 充分利用 `${{ }}` 变量 |
| **约束声明** | 禁止事项 | 用 ⚠️ 或 ❌ 明确标注 |
| **输出格式** | 结构化程度 | 提供模板或示例 |

---

## 角色定义最佳实践

**好的角色定义**:
```markdown
你是一位专业的代码审查专家，专注于 TypeScript 项目的代码质量改进。
你的职责是发现潜在问题并提供建设性的改进建议。
```

**差的角色定义**:
```markdown
帮我看看这个代码。
```

---

## Phase 划分原则

1. **每个 Phase 有明确目标** - 清楚地说明这个阶段要完成什么
2. **Phase 之间有清晰边界** - 输入/输出明确
3. **时间预算合理** - 总时间匹配超时设置
4. **倒金字塔分配** - 关键阶段分配更多时间

**示例**:
```markdown
### Phase 1: 收集上下文 (5 分钟)
目标：理解任务背景

### Phase 2: 分析问题 (10 分钟)
目标：识别关键问题

### Phase 3: 生成报告 (5 分钟)
目标：输出结构化结果
```

---

## 上下文注入模式

### 使用 Handlebars 条件

```markdown
{{#if github.event.issue}}
当前 Issue：#${{ github.event.issue.number }}
标题：${{ github.event.issue.title }}
{{/if}}

{{#if github.event.pull_request}}
当前 PR：#${{ github.event.pull_request.number }}
分支：${{ github.event.pull_request.head.ref }}
{{/if}}
```

### 上下文分支复杂度

| 分支数 | 复杂度 | 建议 |
|--------|--------|------|
| 0 | ⭐ | 简单易懂，维护容易 |
| 1 | ⭐⭐ | 可接受，注意分支标记 |
| 2 | ⭐⭐⭐⭐⭐ | 需要清晰的分支标记和重复约束 |
| 3+ | ⭐⭐⭐⭐⭐⭐ | 考虑拆分为多个工作流 |

---

## 约束声明表达

| 约束类型 | 表达方式 | 示例 |
|---------|---------|------|
| 禁止 | ⚠️ NEVER / ❌ 禁止 | "⚠️ NEVER modify .github/workflows" |
| 必须 | ✅ ALWAYS / MUST | "✅ ALWAYS create PR before merging" |
| 重要 | **IMPORTANT** | "**IMPORTANT**: Check tests first" |
| 强调 | 大写 + 加粗 | "**DO NOT** skip validation" |

---

## 输出格式设计

### 提供模板

```markdown
## 输出格式

请按以下格式输出分析结果：

### 1. 摘要
[一句话总结]

### 2. 发现
- 问题 1: [描述]
- 问题 2: [描述]

### 3. 建议
1. [具体建议]
2. [具体建议]
```

### 提供示例

```markdown
## 输出示例

---
**摘要**: 发现 3 个中等优先级问题

**发现**:
- 问题 1: 权限过大（请求了 admin 权限但只需要 read）
- 问题 2: 超时设置过短（5 分钟但任务需要 15 分钟）

**建议**:
1. 将权限从 admin 降为 read
2. 将超时从 5 分钟增加到 20 分钟
---
```

---

## 质量评估清单

```markdown
## Prompt 检查
- [ ] 有明确的角色定义
- [ ] 有任务分阶段（Phase）
- [ ] 有成功标准
- [ ] 有约束声明（NEVER/ALWAYS）
- [ ] 有输出格式模板或示例
- [ ] 充分利用 GitHub 上下文变量
```

---

## 质量评级

| 等级 | 标准 |
|------|------|
| ⭐⭐⭐ | 清晰角色、分阶段任务、明确约束、结构化输出 |
| ⭐⭐ | 基本可用，结构较清晰 |
| ⭐ | 混乱或缺失关键信息 |
