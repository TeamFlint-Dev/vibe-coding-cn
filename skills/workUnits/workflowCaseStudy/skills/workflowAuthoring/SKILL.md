# Workflow Authoring Skill

> **类型**: Work Unit 子 Skill - 创作技能  
> **职责**: 提供编写 GitHub Agentic Workflows 的最佳实践和可复用模板  
> **维护者**: `workflow-case-study` 工作流自动维护

---

## 📚 简介

本 Skill 专注于**如何编写**一个高质量的 GitHub Agentic Workflow，提供设计模式、代码片段和最佳实践。

**核心理念**: 从真实案例中提炼模式，让每次创作都站在巨人肩膀上。

---

## 🎨 设计模式库

### 1. Slash Command 模式

**适用场景**: 用户通过评论触发的交互式任务

```yaml
---
on:
  slash_command:
    name: mycommand
    events: [issue_comment, pull_request_comment]
permissions:
  contents: read
  issues: read
safe-outputs:
  add-comment:
    max: 1
---
```

**典型案例**: scout, brave, plan

---

### 2. Event-Driven 模式

**适用场景**: 响应 GitHub 事件的自动化任务

```yaml
---
on:
  issues:
    types: [opened, labeled]
  pull_request:
    types: [opened, synchronize]
permissions:
  contents: read
  issues: read
---
```

**典型案例**: issue-classifier, pr-nitpick-reviewer

---

### 3. Scheduled 模式

**适用场景**: 定时执行的报告/维护任务

```yaml
---
on:
  schedule:
    - cron: "0 9 * * 1-5"  # 工作日 9:00 UTC
  workflow_dispatch:  # 也支持手动触发
tracker-id: my-daily-task
---
```

**典型案例**: daily-team-status, ci-coach

---

### 4. Multi-Context 模式

**适用场景**: 需要适配多种触发场景

```markdown
{{#if github.event.issue.number}}
## Issue Context
- **Issue Number**: ${{ github.event.issue.number }}
{{/if}}

{{#if github.event.pull_request.number}}
## PR Context  
- **PR Number**: ${{ github.event.pull_request.number }}
{{/if}}
```

**典型案例**: plan, cloclo, q

---

### 5. Memory-Enabled 模式

**适用场景**: 需要跨运行保持状态

```yaml
tools:
  cache-memory:
    key: my-memory-${{ github.workflow }}
```

**典型案例**: grumpy-reviewer, cloclo

---

## 📦 代码片段库

### Frontmatter 模板

#### 最小配置

```yaml
---
on: workflow_dispatch
permissions:
  contents: read
engine: copilot
timeout-minutes: 10
---
```

#### 完整配置

```yaml
---
name: My Workflow
description: 工作流描述
on:
  workflow_dispatch:
    inputs:
      param1:
        description: '参数说明'
        required: false
        type: string
permissions:
  contents: read
  issues: read
engine: copilot
tools:
  github:
    toolsets: [repos, issues]
  bash: ["*"]
  edit:
safe-outputs:
  create-issue:
    max: 3
    labels: [automation]
  add-comment:
    max: 1
timeout-minutes: 20
strict: true
---
```

### Prompt 结构模板

```markdown
# 工作流标题

你是 [角色描述]，负责 [职责描述]。

## 任务上下文

- **仓库**: ${{ github.repository }}
- **触发者**: ${{ github.actor }}

## 执行流程

### Phase 1: [阶段名称]

[阶段描述]

### Phase 2: [阶段名称]

[阶段描述]

## 约束条件

⚠️ **禁止**: [禁止事项]

## 成功标准

- ✅ [标准1]
- ✅ [标准2]
```

### Messages 模板

```yaml
messages:
  footer: "> 🤖 *Generated by [{workflow_name}]({run_url})*"
  run-started: "🚀 Starting [{workflow_name}]({run_url})..."
  run-success: "✅ [{workflow_name}]({run_url}) completed successfully!"
  run-failure: "❌ [{workflow_name}]({run_url}) {status}. Check logs for details."
```

---

## ✅ 最佳实践

### 权限

- ✅ 使用最小权限原则
- ✅ 优先使用 `safe-outputs` 而非直接 `write` 权限
- ❌ 避免 `contents: write` 除非真的需要

### 超时

| 任务类型 | 推荐超时 |
|---------|---------|
| 简单查询 | 5-10 分钟 |
| 中等分析 | 15-20 分钟 |
| 复杂任务 | 25-30 分钟 |

### Prompt 设计

- ✅ 明确的角色定义
- ✅ 分阶段任务结构
- ✅ 使用 `{{#if}}` 处理条件逻辑
- ✅ 提供成功标准
- ❌ 避免模糊的指令

---

## 📖 学习记录

> 以下内容由 `workflow-case-study` 工作流自动更新

### 新发现的模式

_(待填充)_

### 可复用片段更新

_(待填充)_

---

## 📚 相关文档

- [workflowAnalyzer Skill](../workflowAnalyzer/SKILL.md) - 如何分析工作流
- [父级 SKILL](../../SKILL.md) - 工作单元概览
