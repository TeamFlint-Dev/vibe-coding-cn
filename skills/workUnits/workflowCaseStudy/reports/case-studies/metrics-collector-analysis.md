# Metrics Collector å·¥ä½œæµåˆ†ææŠ¥å‘Š

> **åˆ†ææ—¥æœŸ**: 2026-01-10  
> **è¿è¡Œç¼–å·**: #3  
> **åˆ†æè€…**: workflow-case-study Agent

---

## ğŸ“Œ æ ¸å¿ƒå‘ç°

1. **Infrastructure Agent æ˜¯ä¸€ç§æ–°çš„è§’è‰²ç±»å‹** - ä¸åŒäº Meta-Orchestrator æˆ– Workerï¼Œä¸“é—¨ä¸ºå…¶ä»– Agent æä¾›æ•°æ®æœåŠ¡ï¼Œä½“ç°ã€Œç”Ÿäº§è€…-æ¶ˆè´¹è€…ã€è§£è€¦
2. **repo-memory çš„ç›®å½•ç»“æ„åæ˜ çŸ¥è¯†ç±»å‹** - `metrics/` å­˜å‚¨æ€§èƒ½æ•°æ®ï¼Œ`patterns/` å­˜å‚¨é—®é¢˜æ¨¡å¼ï¼Œè¿™ä¸¤ç§ç›®å½•è®¾è®¡äº’è¡¥
3. **æ—  safe-outputs æ˜¯è®¾è®¡é€‰æ‹©** - çº¯æ•°æ®æ”¶é›†å·¥ä½œæµä¸åº”ä¸ç”¨æˆ·äº¤äº’ï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜ç¡®çš„ã€Œæ²‰é»˜åŸºç¡€è®¾æ–½ã€æ¨¡å¼
4. **branch-name é…ç½®å®ç°å¤š Orchestrator å…±äº«** - `memory/meta-orchestrators` åˆ†æ”¯è®©å¤šä¸ªç¼–æ’å™¨å…±äº«æ•°æ®å±‚
5. **å·¥å…·å±‚æ¬¡æ¸…æ™°** - agentic-workflows æ˜¯ä¸»æ•°æ®æºï¼Œgithub MCP æ˜¯è¾…åŠ©æ•°æ®æº

---

## ğŸ¯ ç ”ç©¶åŠ¨æœº

**é€‰æ‹©ç†ç”±**: 
- éªŒè¯ H003ï¼ˆpatterns/ ç›®å½•è®¾è®¡ï¼‰- æƒ³äº†è§£æ˜¯å¦æ‰€æœ‰å·¥ä½œæµéƒ½ä½¿ç”¨ patterns/ ç›®å½•
- æ”¯æŒç ”ç©¶è®®ç¨‹ P1ï¼ˆå·¥ä½œæµå¯è§‚æµ‹æ€§ï¼‰- è¿™æ˜¯å¯è§‚æµ‹æ€§æ¶æ„çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½
- æ¢ç´¢å¤š Agent åä½œæ¨¡å¼ï¼ˆå¾…è°ƒç ”ä¸»é¢˜ï¼‰- Infrastructure Agent ä½“ç°äº† Agent é—´çš„åä½œ

**ç ”ç©¶é—®é¢˜**:
1. metrics-collector å¦‚ä½•ä¸å…¶ä»– Meta-Orchestrator åä½œï¼Ÿ
2. repo-memory çš„ç›®å½•ç»“æ„æœ‰ä»€ä¹ˆè®¾è®¡åŸåˆ™ï¼Ÿ
3. çº¯æ•°æ®æ”¶é›†å·¥ä½œæµæœ‰ä»€ä¹ˆç‹¬ç‰¹çš„è®¾è®¡æ¨¡å¼ï¼Ÿ

---

## ğŸ“Š åˆ†ææ‘˜è¦

| ç»´åº¦ | é…ç½® | è¯„ä¼° |
|------|------|------|
| è§¦å‘æ–¹å¼ | `on: daily` | â­â­â­ å®šæ—¶æ”¶é›†ï¼Œå‡å°‘å†—ä½™ |
| æƒé™è®¾è®¡ | 5 ä¸ªåªè¯»æƒé™ (contents, issues, pull-requests, discussions, actions) | â­â­â­ æœ€å°æƒé™åŸåˆ™ |
| å·¥å…·ç»„åˆ | agentic-workflows + github (remote) + repo-memory | â­â­â­ ä¸‰å±‚åˆ†å·¥æ¸…æ™° |
| è¶…æ—¶è®¾ç½® | 15 åˆ†é’Ÿ | â­â­â­ é€‚åˆæ•°æ®æ”¶é›†ä»»åŠ¡ |
| è¾“å‡ºæ–¹å¼ | æ—  safe-outputsï¼Œä»… repo-memory å­˜å‚¨ | â­â­â­â­ æ²‰é»˜åŸºç¡€è®¾æ–½è®¾è®¡ |

---

## ğŸ¨ è¯†åˆ«çš„è®¾è®¡æ¨¡å¼

### å·²çŸ¥æ¨¡å¼

| æ¨¡å¼åç§° | åº”ç”¨æ–¹å¼ | ç‰¹åˆ«ä¹‹å¤„ |
|---------|---------|---------|
| Shared Metrics Infrastructure Pattern | å®Œå…¨åŒ¹é… | metrics-collector æ˜¯è¯¥æ¨¡å¼çš„**å®šä¹‰æ¡ˆä¾‹** |
| Scheduled Trigger Pattern | `on: daily` | æ— æ¨¡ç³Šè°ƒåº¦ï¼Œæ¯æ—¥å›ºå®šæ”¶é›† |
| Metrics-Driven Analysis Pattern | ä¸ºå…¶ä»–å·¥ä½œæµæä¾›æ•°æ® | ä½œä¸ºæ•°æ®ç”Ÿäº§è€… |

### ğŸ†• æ–°å‘ç°æ¨¡å¼

**æ¨¡å¼åç§°**: Infrastructure Agent Pattern
- **è¯†åˆ«ç‰¹å¾**: 
  - æ—  safe-outputs é…ç½®
  - æ˜ç¡®çš„ã€Œæ¶ˆè´¹è€…åˆ—è¡¨ã€ï¼ˆä¸ºè°æœåŠ¡ï¼‰
  - repo-memory ä½œä¸ºå”¯ä¸€è¾“å‡º
  - Prompt æ˜ç¡®å£°æ˜ã€ŒDO NOT create issues/PRs/commentsã€
- **è®¾è®¡æ„å›¾**: 
  - å°†æ•°æ®æ”¶é›†ä¸æ•°æ®æ¶ˆè´¹è§£è€¦
  - å‡å°‘ API è°ƒç”¨ï¼ˆ120 ä¸ªå·¥ä½œæµåªæŸ¥è¯¢ä¸€æ¬¡ï¼‰
  - æ ‡å‡†åŒ–æ•°æ®æ ¼å¼
- **å¯å¤ç”¨ä»·å€¼**: â­â­â­â­â­ ä»»ä½•éœ€è¦å…±äº«æ•°æ®å±‚çš„å¤š Agent ç³»ç»Ÿéƒ½å¯é‡‡ç”¨

**æ¨¡å¼åç§°**: Shared Memory Branch Pattern
- **è¯†åˆ«ç‰¹å¾**:
  - `repo-memory.branch-name` æŒ‡å®šä¸“ç”¨åˆ†æ”¯
  - `file-glob` é™åˆ¶è®¿é—®èŒƒå›´
  - å¤šä¸ªå·¥ä½œæµå…±äº«åŒä¸€åˆ†æ”¯
- **è®¾è®¡æ„å›¾**:
  - éš”ç¦»æ•°æ®ä¸ä»£ç 
  - é¿å…ä¸»åˆ†æ”¯æ±¡æŸ“
  - å®ç°æ•°æ®å±‚çš„ç‰ˆæœ¬æ§åˆ¶
- **å¯å¤ç”¨ä»·å€¼**: â­â­â­â­ å¤š Agent åä½œåœºæ™¯å¿…å¤‡

**æ¨¡å¼åç§°**: Data Retention Policy Pattern
- **è¯†åˆ«ç‰¹å¾**:
  - æ˜ç¡®çš„ä¿ç•™æœŸï¼ˆ30 å¤©ï¼‰
  - è‡ªåŠ¨æ¸…ç†å‘½ä»¤
  - latest.json æ°¸ä¹…ä¿ç•™
- **è®¾è®¡æ„å›¾**:
  - æ§åˆ¶å­˜å‚¨å¢é•¿
  - ä¿è¯å†å²å¯æŸ¥
  - å¿«é€Ÿè®¿é—®æœ€æ–°æ•°æ®
- **å¯å¤ç”¨ä»·å€¼**: â­â­â­ ä»»ä½•æŒä¹…åŒ–å­˜å‚¨åœºæ™¯éƒ½éœ€è¦

---

## ğŸ’» å¯å¤ç”¨ç‰‡æ®µ

### repo-memory é…ç½®ï¼ˆå¤š Orchestrator å…±äº«ï¼‰

```yaml
# ç‰‡æ®µåç§°: shared-memory-config
# ç”¨é€”: è®©å¤šä¸ª Meta-Orchestrator å…±äº«æ•°æ®å±‚
tools:
  repo-memory:
    branch-name: memory/meta-orchestrators
    file-glob: "metrics/**"
```

### æ•°æ®ä¿ç•™ç­–ç•¥

```bash
# ç‰‡æ®µåç§°: data-retention-cleanup
# ç”¨é€”: æ¸…ç†è¶…è¿‡ 30 å¤©çš„æ—§æ•°æ®
find /tmp/gh-aw/repo-memory/default/metrics/daily/ -name "*.json" -mtime +30 -delete
```

### å·¥å…·å±‚æ¬¡å£°æ˜

```markdown
# ç‰‡æ®µåç§°: tool-hierarchy-doc
# ç”¨é€”: æ˜ç¡®å·¥å…·ä½¿ç”¨ä¼˜å…ˆçº§
**PRIMARY TOOL**: Use the agentic-workflows tool (`status`, `logs`) for all workflow run metrics
**SECONDARY TOOL**: Use GitHub MCP server only for engagement metrics (reactions, comments)
```

---

## ğŸ¤” æ‰¹åˆ¤æ€§åˆ†æ

### è®¾è®¡äº®ç‚¹

1. **èŒè´£å•ä¸€**: åªåšæ•°æ®æ”¶é›†ï¼Œä¸åšæ•°æ®åˆ†æï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™
2. **æ¶ˆè´¹è€…æ˜ç¡®**: Prompt ä¸­åˆ—å‡ºäº† 3 ä¸ªæ¶ˆè´¹è€…ï¼ˆAgent Performance Analyzer, Campaign Manager, Workflow Health Managerï¼‰ï¼Œä¾¿äºç†è§£æ¶æ„
3. **æ•°æ®æ ¼å¼æ ‡å‡†åŒ–**: æä¾›äº†å®Œæ•´çš„ JSON Schemaï¼Œæ¶ˆè´¹è€…å¯ä»¥ä¿¡èµ–æ•°æ®æ ¼å¼
4. **ä¼˜é›…çš„åˆ†å±‚å­˜å‚¨**: daily/*.json æä¾›å†å²è§†å›¾ï¼Œlatest.json æä¾›å¿«é€Ÿè®¿é—®
5. **æ¸…æ™°çš„çº¦æŸ**: æ˜ç¡®å£°æ˜ã€Œä¸åˆ›å»º Issue/PR/Commentã€

### æ”¹è¿›å»ºè®®

1. **ç¼ºå°‘å¥åº·æ£€æŸ¥**: æ²¡æœ‰ç›‘æ§ metrics-collector è‡ªèº«çš„å¥åº·çŠ¶å†µï¼ˆå¦‚æœå®ƒå¤±è´¥ï¼Œä¸‹æ¸¸ Orchestrator ä¼šå—å½±å“ï¼‰
2. **ç¡¬ç¼–ç è·¯å¾„**: `/tmp/gh-aw/repo-memory/default/metrics/` å¯ä»¥å‚æ•°åŒ–
3. **ç¼ºå°‘æ•°æ®éªŒè¯**: è™½ç„¶æåˆ°ã€Œç”¨ jq éªŒè¯ã€ï¼Œä½†æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œ
4. **æ— å‘Šè­¦æœºåˆ¶**: æ”¶é›†å¤±è´¥æ—¶æ²¡æœ‰é€šçŸ¥æœºåˆ¶

---

## ğŸ“ Skill æ›´æ–°å»ºè®®

- [x] workflowAnalyzer/patterns/DATA.md: æ·»åŠ  "Infrastructure Agent Pattern"
- [x] workflowAnalyzer/patterns/DATA.md: æ·»åŠ  "Shared Memory Branch Pattern"
- [x] workflowAnalyzer/patterns/DATA.md: æ·»åŠ  "Data Retention Policy Pattern"
- [ ] hypothesis/HYPOTHESES.md: æå‡ºæ–°çŒœæƒ³ "H005: repo-memory ç›®å½•ç»“æ„åæ˜ çŸ¥è¯†ç±»å‹"
- [ ] hypothesis/H003: æ›´æ–°è¯æ®ï¼ˆmetrics/ vs patterns/ å¯¹æ¯”ï¼‰

---

## ğŸ”® åç»­ç ”ç©¶æ–¹å‘

1. **æ¢ç´¢ agentic-workflows å·¥å…·çš„å®Œæ•´èƒ½åŠ›** - statusã€logs ä¹‹å¤–è¿˜æœ‰ä»€ä¹ˆï¼Ÿ
2. **éªŒè¯å¤š Orchestrator çš„åè°ƒæœºåˆ¶** - ä»–ä»¬å¦‚ä½•é¿å…é‡å¤å·¥ä½œï¼Ÿ
3. **ç ”ç©¶ repo-memory åˆ†æ”¯ç­–ç•¥** - ä¸ºä»€ä¹ˆé€‰æ‹© `memory/meta-orchestrators` è€Œéå…¶ä»–åç§°ï¼Ÿ

---

## ğŸ”— ä¸çŒœæƒ³åº“çš„å…³ç³»

### H003: patterns/ ç›®å½•æ˜¯çŸ¥è¯†æ²‰æ·€çš„å…³é”®

**æ–°è¯æ®**: metrics-collector ä½¿ç”¨ `metrics/` è€Œé `patterns/`

**ä¿®æ­£æ–¹å‘**: 
- åŸçŒœæƒ³è¿‡äºç‹­çª„ï¼ˆåªå…³æ³¨ patterns/ï¼‰
- æ›´å‡†ç¡®çš„è¡¨è¿°ï¼šã€Œrepo-memory çš„ç›®å½•ç»“æ„åº”åæ˜ çŸ¥è¯†ç±»å‹ã€
- patterns/ å­˜å‚¨**é—®é¢˜æ¨¡å¼**ï¼ˆé”™è¯¯ã€å¤±è´¥åŸå› ï¼‰
- metrics/ å­˜å‚¨**æ€§èƒ½æ•°æ®**ï¼ˆè¿è¡Œæ¬¡æ•°ã€æˆåŠŸç‡ï¼‰

### H001: ç»“æ„åŒ–æ•°æ®å·¥å…·ä¼˜äºæ–‡æœ¬è§£æ

**æ”¯æŒè¯æ®**: 
- agentic-workflows å·¥å…·æä¾›ç»“æ„åŒ–çš„æ—¥å¿—æ•°æ®
- Prompt æ˜ç¡®å£°æ˜ã€ŒPRIMARY TOOL: agentic-workflowsã€
- è¿™ç¬¦åˆã€Œä½¿ç”¨æ­£ç¡®çš„å·¥å…·åšæ­£ç¡®çš„äº‹ã€åŸåˆ™

---

*æŠ¥å‘Šç»“æŸ*
