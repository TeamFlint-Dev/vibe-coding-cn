# GitHub Agentic Workflows æƒé™æ§åˆ¶è§„åˆ™

> **ç‰ˆæœ¬**: 1.0 | **æ›´æ–°æ—¥æœŸ**: 2026-01-03
>
> **ç›®æ ‡**: ç¡®ä¿ Agent åˆ›å»ºå·¥ä½œæµæ—¶ä¸ä¼šå› æƒé™é…ç½®é”™è¯¯å¯¼è‡´ç¼–è¯‘å¤±è´¥æˆ–è¿è¡Œæ—¶æƒé™ä¸è¶³

---

## æ ¸å¿ƒç»“è®º

**è¦ä½¿ç”¨ write æƒé™çº§åˆ«ï¼Œå¿…é¡»ç¦ç”¨ strict æ¨¡å¼ï¼ˆ`strict: false`ï¼‰**ã€‚

ä½†å®˜æ–¹**å¼ºçƒˆå»ºè®®**ä½¿ç”¨ `safe-outputs` æœºåˆ¶æ›¿ä»£ç›´æ¥çš„ write æƒé™ã€‚

---

## æƒé™æ§åˆ¶çš„ä¸¤ç§æ¨¡å¼

### Strict æ¨¡å¼ï¼ˆé»˜è®¤å¯ç”¨ï¼‰

```yaml
strict: true  # é»˜è®¤å€¼ï¼Œå¯çœç•¥
```

**Strict æ¨¡å¼çš„é™åˆ¶**ï¼š

| é™åˆ¶é¡¹ | è¯´æ˜ |
|--------|------|
| âŒ ç¦æ­¢ write æƒé™ | ä¸å…è®¸ `contents: write`, `issues: write`, `pull-requests: write` ç­‰ |
| âŒ å¿…é¡»æ˜¾å¼ç½‘ç»œé…ç½® | ä¸å…è®¸éšå¼çš„ç½‘ç»œè®¿é—® |
| âŒ ç¦æ­¢ bash é€šé…ç¬¦ | ä¸å…è®¸ `bash: [":*"]` |
| âŒ Actions å¿…é¡» SHA å›ºå®š | ä¸å…è®¸ `actions/checkout@v4`ï¼Œå¿…é¡»ç”¨å®Œæ•´ SHA |
| âŒ ç¦æ­¢é€šé…ç¬¦åŸŸå | ä¸å…è®¸ `*.example.com` |

### é Strict æ¨¡å¼

```yaml
strict: false  # æ˜¾å¼ç¦ç”¨
```

**ç¦ç”¨åå¯ä»¥**ï¼š
- âœ… ä½¿ç”¨ `permissions: write-all` æˆ–å…·ä½“çš„ write æƒé™
- âœ… ä½¿ç”¨ bash é€šé…ç¬¦å·¥å…· `bash: [":*"]`
- âœ… ä½¿ç”¨ tag å¼•ç”¨ Actionsï¼ˆå¦‚ `@v4`ï¼‰

---

## æ¨èæ–¹æ¡ˆï¼šä½¿ç”¨ safe-outputsï¼ˆæ— éœ€ write æƒé™ï¼‰

å®˜æ–¹**å¼ºçƒˆæ¨è**ä½¿ç”¨ `safe-outputs` æœºåˆ¶ï¼Œå®ƒé€šè¿‡ç‹¬ç«‹çš„ job å¤„ç†å†™æ“ä½œï¼Œä¸» job åªéœ€è¦ read æƒé™ï¼š

```yaml
---
on: workflow_dispatch
permissions:
  contents: read      # â­ åªéœ€ read æƒé™
  actions: read

safe-outputs:
  create-issue:       # è‡ªåŠ¨å¤„ç† Issue åˆ›å»º
    title-prefix: "[bot] "
    labels: [automation]
  add-comment:        # è‡ªåŠ¨å¤„ç†è¯„è®º
    max: 5
  create-pull-request: # è‡ªåŠ¨å¤„ç† PR åˆ›å»º
    draft: true
---

# Agent æŒ‡ä»¤...
```

### safe-outputs çš„å·¥ä½œåŸç†

```
Main Job (read-only)          Separate Job (with write)
       â†“                              â†“
AI å¤„ç† â†’ è¾“å‡ºç»“æ„åŒ–æ•°æ® â†’ safe-outputs job æ‰§è¡Œå†™æ“ä½œ
```

### æ”¯æŒçš„ safe-outputs ç±»å‹

| æ“ä½œ | è¯´æ˜ | å¸¸ç”¨é…ç½® |
|------|------|----------|
| `create-issue` | åˆ›å»º Issue | `title-prefix`, `labels`, `assignees`, `max` |
| `update-issue` | æ›´æ–° Issue | `target`, `title`, `body`, `labels` |
| `close-issue` | å…³é—­ Issue | `required-labels`, `required-title-prefix` |
| `add-comment` | æ·»åŠ è¯„è®º | `max`, `target`, `hide-older-comments` |
| `create-pull-request` | åˆ›å»º PR | `title-prefix`, `labels`, `reviewers`, `draft` |
| `update-pull-request` | æ›´æ–° PR | `target`, `title`, `body` |
| `close-pull-request` | å…³é—­ PR | `required-labels` |
| `push-to-pull-request-branch` | æ¨é€åˆ° PR åˆ†æ”¯ | - |
| `create-discussion` | åˆ›å»º Discussion | `category`, `labels` |
| `update-discussion` | æ›´æ–° Discussion | `target`, `title`, `body`, `labels` |
| `close-discussion` | å…³é—­ Discussion | `required-labels`, `required-category` |
| `add-labels` | æ·»åŠ æ ‡ç­¾ | `allowed-labels` |
| `add-reviewer` | æ·»åŠ å®¡æŸ¥è€… | - |
| `assign-milestone` | åˆ†é…é‡Œç¨‹ç¢‘ | - |
| `assign-to-agent` | åˆ†é…ç»™ Copilot | - |
| `create-agent-task` | åˆ›å»º Agent ä»»åŠ¡ | `base`, `target-repo` |
| `update-project` | æ›´æ–°é¡¹ç›®çœ‹æ¿ | `max` |
| `create-pull-request-review-comment` | åˆ›å»º PR å®¡æŸ¥è¯„è®º | `max`, `side` |
| `link-sub-issue` | é“¾æ¥å­ Issue | - |
| `upload-asset` | ä¸Šä¼ èµ„äº§ | - |
| `update-release` | æ›´æ–° Release | - |
| `hide-comment` | éšè—è¯„è®º | - |

---

## å¿…é¡»ä½¿ç”¨ write æƒé™çš„åœºæ™¯

å½“ `safe-outputs` æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä»¥ç¦ç”¨ strict æ¨¡å¼ï¼š

```yaml
---
# âš ï¸ éœ€è¦ strict: false å› ä¸ºï¼š[å†™æ˜å…·ä½“åŸå› ]
strict: false

permissions:
  contents: write             # ç°åœ¨å¯ä»¥ä½¿ç”¨ write
  issues: write
  pull-requests: write

tools:
  github:
    toolsets: [all]           # å®Œæ•´ GitHub API è®¿é—®
  bash: [":*"]                # å®Œæ•´ bash è®¿é—®
  edit:
---

# Agent æŒ‡ä»¤...
```

### ä½•æ—¶éœ€è¦ç›´æ¥ write æƒé™

| åœºæ™¯ | åŸå›  | safe-outputs ä¸ºä½•ä¸è¡Œ |
|------|------|----------------------|
| å¤æ‚çš„ Git æ“ä½œ | éœ€è¦ç›´æ¥ push åˆ°ä»“åº“ | safe-outputs åªæ”¯æŒ PR æ¨¡å¼ |
| æ‰¹é‡æ ‡ç­¾ç®¡ç† | éœ€è¦ä¸€æ¬¡æ“ä½œå¤šä¸ªæ ‡ç­¾ | safe-outputs æœ‰æ•°é‡é™åˆ¶ |
| è‡ªå®šä¹‰ GitHub API è°ƒç”¨ | é€šè¿‡ bash/script ç›´æ¥è°ƒç”¨ | éœ€è¦ token æœ‰å¯¹åº”æƒé™ |
| Webhook å“åº” | éœ€è¦å³æ—¶å†™æ“ä½œ | safe-outputs æ˜¯å¼‚æ­¥çš„ |
| ä¿®æ”¹ä»“åº“è®¾ç½® | éœ€è¦ admin æƒé™ | safe-outputs ä¸æ”¯æŒ |

---

## æƒé™çº§åˆ«é€ŸæŸ¥

```yaml
# çº§åˆ« 1ï¼šåªè¯»ï¼ˆæœ€å®‰å…¨ï¼Œæ¨èï¼‰
permissions: read-all

# çº§åˆ« 2ï¼šç»†ç²’åº¦åªè¯»
permissions:
  contents: read
  issues: read
  pull-requests: read

# çº§åˆ« 3ï¼šsafe-outputs æ¨¡å¼ï¼ˆæ¨èç”¨äºå†™æ“ä½œï¼‰
permissions:
  contents: read
safe-outputs:
  create-issue:
  add-comment:

# çº§åˆ« 4ï¼šç»†ç²’åº¦å†™ï¼ˆéœ€è¦ strict: falseï¼‰
strict: false
permissions:
  contents: read
  issues: write        # åªç»™éœ€è¦çš„æƒé™

# çº§åˆ« 5ï¼šå®Œå…¨å†™æƒé™ï¼ˆä¸æ¨èï¼‰
strict: false
permissions: write-all
```

---

## å†³ç­–æµç¨‹å›¾

```
éœ€è¦å†™æ“ä½œ?
â”‚
â”œâ”€â”€ åˆ›å»º Issue/PR/è¯„è®º/Discussionï¼Ÿ
â”‚   â””â”€â”€ âœ… ä½¿ç”¨ safe-outputsï¼Œä¿æŒ strict æ¨¡å¼
â”‚
â”œâ”€â”€ æ›´æ–° Issue/PR/Discussionï¼Ÿ
â”‚   â””â”€â”€ âœ… ä½¿ç”¨ safe-outputs.update-xxx
â”‚
â”œâ”€â”€ éœ€è¦ç›´æ¥ git pushï¼ˆä¸èµ° PRï¼‰ï¼Ÿ
â”‚   â””â”€â”€ ğŸŸ¡ strict: false + contents: write
â”‚
â”œâ”€â”€ éœ€è¦æ‰¹é‡/å¤æ‚æ“ä½œï¼Ÿ
â”‚   â””â”€â”€ ğŸŸ¡ strict: false + å…·ä½“ write æƒé™
â”‚
â””â”€â”€ ä¸ç¡®å®šï¼Ÿ
    â””â”€â”€ å…ˆç”¨ safe-outputs è¯•è¯•ï¼Œä¸è¡Œå†ç¦ç”¨ strict
```

---

## å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1ï¼šStrict æ¨¡å¼ä¸‹ä½¿ç”¨ write æƒé™

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: strict mode validation failed: write permissions not allowed
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# æ–¹æ¡ˆ Aï¼šæ”¹ç”¨ safe-outputsï¼ˆæ¨èï¼‰
permissions:
  contents: read
safe-outputs:
  create-issue:

# æ–¹æ¡ˆ Bï¼šç¦ç”¨ strict æ¨¡å¼
strict: false
permissions:
  issues: write
```

### é”™è¯¯ 2ï¼šStrict æ¨¡å¼ä¸‹ä½¿ç”¨ bash é€šé…ç¬¦

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: strict mode validation failed: bash wildcard tools not allowed
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# æ–¹æ¡ˆ Aï¼šæ˜ç¡®åˆ—å‡ºéœ€è¦çš„å‘½ä»¤
tools:
  bash: ["git *", "npm *", "curl *"]

# æ–¹æ¡ˆ Bï¼šç¦ç”¨ strict æ¨¡å¼
strict: false
tools:
  bash: [":*"]
```

### é”™è¯¯ 3ï¼šæƒé™ä¸è¶³å¯¼è‡´ API è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Resource not accessible by integration
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ˜¯å¦é…ç½®äº†æ­£ç¡®çš„ `permissions`
2. æ£€æŸ¥æ˜¯å¦é…ç½®äº†å¯¹åº”çš„ `safe-outputs`
3. å¦‚æœä½¿ç”¨ PATï¼Œç¡®ä¿ token æœ‰å¯¹åº”çš„ scope

### é”™è¯¯ 4ï¼šsafe-outputs æœªç”Ÿæ•ˆ

**å¯èƒ½åŸå› **ï¼š
- ä¸» job æ²¡æœ‰æ­£ç¡®è¾“å‡ºç»“æ„åŒ–æ•°æ®
- safe-outputs é…ç½®çš„ `target` ä¸åŒ¹é…
- ç¼ºå°‘ `actions: read` æƒé™

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
permissions:
  contents: read
  actions: read       # âš ï¸ å¿…é¡»æœ‰è¿™ä¸ªæƒé™

safe-outputs:
  add-comment:
    target: "*"       # å…è®¸ä»»æ„ Issue/PR
```

---

## å®‰å…¨æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨ safe-outputs**ï¼š90% çš„åœºæ™¯ä¸éœ€è¦ç›´æ¥ write æƒé™
2. **æœ€å°æƒé™åŸåˆ™**ï¼šåªè¯·æ±‚å¿…éœ€çš„æƒé™
3. **é¿å… write-all**ï¼šå³ä½¿ç¦ç”¨ strict ä¹Ÿåº”ç»†ç²’åº¦æˆæƒ
4. **è®°å½•ç†ç”±**ï¼šç¦ç”¨ strict æ—¶åœ¨æ³¨é‡Šä¸­è¯´æ˜åŸå› 

```yaml
---
# âš ï¸ éœ€è¦ strict: false å› ä¸ºï¼šéœ€è¦ç›´æ¥æ¨é€è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç åˆ°ä»“åº“
strict: false
permissions:
  contents: write     # ä»… contentsï¼Œå…¶ä»–ä¿æŒ read
---
```

5. **å®šæœŸå®¡æŸ¥**ï¼šæ£€æŸ¥å·¥ä½œæµæ˜¯å¦ä»éœ€è¦ write æƒé™

---

## å¿«é€Ÿæ¨¡æ¿

### æ¨¡æ¿ Aï¼šåªè¯»åˆ†æç±»å·¥ä½œæµ

```yaml
---
on: workflow_dispatch
permissions:
  contents: read
  issues: read
  pull-requests: read
tools:
  github:
    toolsets: [default]
  web-fetch:
network:
  allowed: [defaults, github]
---

åˆ†æä»£ç åº“å¹¶è¾“å‡ºæŠ¥å‘Š...
```

### æ¨¡æ¿ Bï¼šéœ€è¦åˆ›å»º Issue/PR çš„å·¥ä½œæµ

```yaml
---
on: workflow_dispatch
permissions:
  contents: read
  actions: read
safe-outputs:
  create-issue:
    title-prefix: "[auto] "
    labels: [automation]
  create-pull-request:
    title-prefix: "[auto] "
    draft: true
tools:
  github:
    toolsets: [default]
  edit:
network:
  allowed: [defaults, github]
---

åˆ†æé—®é¢˜å¹¶åˆ›å»ºä¿®å¤ PR...
```

### æ¨¡æ¿ Cï¼šéœ€è¦å®Œæ•´å†™æƒé™çš„å·¥ä½œæµ

```yaml
---
# âš ï¸ ç¦ç”¨ strict æ¨¡å¼åŸå› ï¼šéœ€è¦ç›´æ¥æ“ä½œä»“åº“å†…å®¹
strict: false
on: workflow_dispatch
permissions:
  contents: write
  issues: write
  pull-requests: write
tools:
  github:
    toolsets: [all]
  bash: [":*"]
  edit:
sandbox:
  agent: false
network:
  allowed: [defaults, github]
---

æ‰§è¡Œå¤æ‚çš„ä»“åº“æ“ä½œ...
```

---

## ç›¸å…³æ–‡æ¡£

- [CAPABILITY-BOUNDARIES.md](CAPABILITY-BOUNDARIES.md) - å®Œæ•´èƒ½åŠ›è¾¹ç•Œ
- [WORKFLOW-INDEX.md](WORKFLOW-INDEX.md) - å·¥ä½œæµæ¨¡æ¿ç´¢å¼•
- [å®˜æ–¹æŒ‡å¼•.md](å®˜æ–¹æŒ‡å¼•.md) - å®˜æ–¹æ–‡æ¡£ç¿»è¯‘
