# 审计模式与检查清单

> 版本: 1.0 | 更新: 2025-12-26

game-skill-auditor 使用的深度审计模式和检查项定义。

---

## 五维度审计体系

### 维度 1: 结构完整性 (20%)

**目标**: 确保 SKILL.md 符合标准格式规范

| 检查项 | 权重 | 检查方式 | 通过标准 |
|--------|------|----------|----------|
| YAML frontmatter 存在 | 5% | 正则匹配 `^---` | frontmatter 块完整 |
| name 字段有效 | 3% | 正则 `^[a-z][a-z0-9-]*$` | 匹配命名规范 |
| description 包含触发条件 | 4% | 关键词检测 | 含"当用户说" |
| 必需章节完整 | 5% | 标题扫描 | 4 个必需章节存在 |
| 格式规范 | 3% | Markdown lint | 无 lint 错误 |

**必需章节**:
- `## When to Use This Skill`
- `## Not For / Boundaries`
- `## Quick Reference`
- `## Examples`

**常见问题**:
- frontmatter 缺失或格式错误
- name 包含大写字母或特殊字符
- description 过于简短，缺少触发词

---

### 维度 2: 触发可判定性 (25%)

**目标**: 确保 Skill 可被正确激活且不误触发

| 检查项 | 权重 | 检查方式 | 通过标准 |
|--------|------|----------|----------|
| 触发条件数量 | 8% | 列表项计数 | ≥ 3 个场景 |
| 触发词具体性 | 7% | 语义分析 | 非模糊词汇 |
| 排除项定义 | 5% | Not For 检查 | ≥ 2 个排除 |
| 触发词唯一性 | 5% | 跨 Skill 对比 | 无重复触发词 |

**模糊词汇黑名单**:
```
处理、做、弄、搞、整、看看、帮我、这个、那个
```

**具体词汇示例**:
```
设计游戏概念、拆分系统、定义机制规则、平衡数值、选择技术栈
```

**常见问题**:
- 触发条件过于宽泛（如"帮我做游戏"）
- 与其他 Skill 触发词冲突
- 缺少 Not For 边界定义

---

### 维度 3: 示例可复现性 (25%)

**目标**: 确保示例完整、可执行、覆盖边界

| 检查项 | 权重 | 检查方式 | 通过标准 |
|--------|------|----------|----------|
| 示例数量 | 8% | Examples 章节计数 | ≥ 2 个示例 |
| 示例结构完整 | 7% | 字段检查 | 含输入/步骤/输出 |
| 输出格式一致 | 5% | 模板对比 | 与 Quick Reference 匹配 |
| 边界情况覆盖 | 5% | 语义分析 | 含异常/边界示例 |

**示例必需字段**:
```markdown
### Example N: [场景名]

**输入**: [用户输入]

**步骤**:
1. [步骤 1]
2. [步骤 2]
...

**输出**: [预期结果]
```

**边界情况类型**:
- 输入不完整
- 依赖文件缺失
- 数值为 0 或负数
- 极端输入

**常见问题**:
- 只有 1 个示例
- 示例缺少步骤说明
- 输出与模板不一致

---

### 维度 4: 数值合理性 (15%)

**目标**: 确保公式正确、边界处理完善

| 检查项 | 权重 | 检查方式 | 通过标准 |
|--------|------|----------|----------|
| 变量定义完整 | 5% | 公式扫描 | 所有变量有定义 |
| 边界值处理 | 4% | 语义分析 | 处理 0/负/极大值 |
| 单位一致性 | 3% | 单位提取对比 | 同类数值单位统一 |
| 示例可验算 | 3% | 数值计算 | 公式结果正确 |

**常见单位问题**:
```
时间: 秒/分钟/小时 混用
货币: 金币/钻石 单位不明
概率: 百分比/小数 混用
```

**边界值检查模板**:
```
当 X = 0 时: [处理方式]
当 X < 0 时: [处理方式]
当 X > MAX 时: [处理方式]
```

**常见问题**:
- 公式引用未定义变量
- 除法未处理除零情况
- 概率未限制在 [0, 1] 范围

---

### 维度 5: 接口一致性 (15%)

**目标**: 确保 Skill 间数据流畅通

| 检查项 | 权重 | 检查方式 | 通过标准 |
|--------|------|----------|----------|
| 输入文件声明 | 4% | 必需输入检查 | 列出所有依赖 |
| 输出文件格式 | 4% | 模板对比 | 格式与模板一致 |
| 依赖 Skill 兼容 | 4% | 跨 Skill 检查 | 输入格式匹配输出 |
| 文件命名规范 | 3% | 正则检查 | 遵循 @*.md 约定 |

**文件命名规范**:
```
memory-bank 文件: @{name}.md 或 @{category}/{name}.md
输出文件必须以 @ 开头
使用小写字母和中划线
```

**依赖链验证**:
```
concept.md 格式 → system-designer 输入格式
system-breakdown.md 格式 → mechanics-designer 输入格式
...
```

**常见问题**:
- 声明依赖但未实际使用
- 输出格式与下游 Skill 期望不匹配
- 文件名不符合 @*.md 规范

---

## 审计顺序规则

全局审计时，按依赖链从上游到下游执行：

```
层级 0 (无依赖):
├── game-concept-designer

层级 1 (依赖 concept):
├── game-system-designer

层级 2 (依赖 system):
├── game-mechanics-designer
├── game-tech-stack-planner

层级 3 (依赖 mechanics):
├── game-economy-designer

层级 4 (依赖所有):
├── game-implementation-planner

层级 5 (元层级):
├── game-skill-auditor
├── game-skill-optimizer
```

**审计规则**:
1. 同层级可并行审计
2. 下层审计前，上层必须通过
3. 接口检查需上层 Skill 已审计

---

## 问题模式库

### 模式 P1: 公式变量未定义

**识别**:
```
公式中出现变量，但在前文无定义表或说明
```

**修复模板**:
```markdown
### 变量定义

| 变量 | 默认值 | 说明 |
|------|--------|------|
| {var} | {default} | {description} |

### 公式
{formula}
```

### 模式 P2: 示例不足

**识别**:
```
Examples 章节中 ### Example 数量 < 2
```

**修复模板**:
```markdown
### Example 2: 边界情况

**输入**: [边界/异常输入]

**步骤**:
1. 检测边界条件
2. 执行降级处理
3. 返回安全默认值

**输出**: [安全输出或错误提示]
```

### 模式 P3: 触发词冲突

**识别**:
```
多个 Skill 的 description 包含相同触发词
```

**修复方式**:
```
1. 细化触发词（添加领域限定）
2. 在 Not For 中排除冲突场景
3. 调整为复合触发条件
```

### 模式 P4: 输出格式不一致

**识别**:
```
Examples 输出格式与 Quick Reference 模板不匹配
```

**修复方式**:
```
1. 对齐示例输出与模板
2. 或更新模板以反映实际输出
```
