# 🏠 基地系统 - 机制设计

> **系统**：Base System  
> **版本**：v1.0  
> **前置依赖**：`@mechanics/trophy.md`  
> **生成者**：game-mechanics-designer

---

## 一、系统概述

**核心职责**：管理展示位与战利品的放置、替换、视觉呈现。

**设计目标**：

- 可视化的成就感载体
- 简单的放置/替换操作
- 基地成为玩家的「个人博物馆」

---

## 二、展示位设计

### 2.1 展示位数据结构

```verse
display_slot := struct:
    SlotId : int              # 位置编号 1-3
    Position : vector3        # 世界坐标
    Rotation : rotation       # 朝向
    OccupiedBy : ?fish_data   # 当前放置的鱼（可为空）
    PlacedAt : ?timestamp     # 放置时间
```

### 2.2 MVP 展示位布局

```
                    ┌─────────────────────────────────┐
                    │           玩家基地              │
                    │                                 │
                    │    ┌───┐   ┌───┐   ┌───┐       │
                    │    │ 1 │   │ 2 │   │ 3 │       │
                    │    │   │   │   │   │   │       │
                    │    └───┘   └───┘   └───┘       │
                    │      ▲       ▲       ▲         │
                    │      │       │       │         │
                    │   展示台  展示台  展示台        │
                    │                                 │
                    │         🧍 玩家                 │
                    │                                 │
                    └─────────────────────────────────┘

位置配置：
Slot 1: Position(-200, 0, 100), Rotation(0°)
Slot 2: Position(0, 0, 100), Rotation(0°)  
Slot 3: Position(200, 0, 100), Rotation(0°)
```

### 2.3 展示位状态

```
            ┌────────────┐
            │   EMPTY    │ ◀──────────────────┐
            └────────────┘                    │
                  │                           │
                  │ [放置鱼]                  │ [取回鱼]
                  ▼                           │
            ┌────────────┐                    │
            │  OCCUPIED  │ ───────────────────┘
            └────────────┘
                  │
                  │ [替换鱼]
                  ▼
            ┌────────────┐
            │ REPLACING  │ ─── 旧鱼回背包 + 新鱼放置
            └────────────┘
                  │
                  ▼
            ┌────────────┐
            │  OCCUPIED  │
            └────────────┘
```

---

## 三、操作清单

### 3.1 放置操作

| 操作 | 前置条件 | 结果 |
|------|----------|------|
| PlaceFish | 展示位为空 + 背包有鱼 | 鱼从背包移除，放置到展示位 |
| ReplaceFish | 展示位已占用 + 背包有鱼 | 旧鱼回背包，新鱼放置 |
| RetrieveFish | 展示位已占用 | 鱼回到背包，展示位清空 |

### 3.2 交互方式

**方式一：从背包放置**（主要流程）

```
打开背包 → 选中鱼 → 点击「放置」→ 选择展示位 → 完成
```

**方式二：直接交互展示位**（快捷操作）

```
靠近展示位 → 按 [E] 交互 → 
    └── 空位：打开背包选择鱼
    └── 有鱼：显示选项（取回/替换/查看）
```

---

## 四、视觉呈现

### 4.1 展示台样式

| 组件 | 描述 |
|------|------|
| 底座 | 石质圆形底座，直径 100cm |
| 水缸 | 透明玻璃圆柱，高 80cm |
| 铭牌 | 底座前方，显示鱼名和稀有度 |
| 灯光 | 顶部聚光灯，颜色随稀有度变化 |

### 4.2 稀有度视觉差异

| 稀有度 | 灯光颜色 | 水缸效果 | 铭牌样式 |
|--------|----------|----------|----------|
| Common | 白色 | 普通水 | 木质铭牌 |
| Uncommon | 淡绿色 | 微光水面 | 铜质铭牌 |
| Rare | 蓝色 | 气泡上升 | 银质铭牌 |
| Epic | 紫色 | 光晕环绕 | 金质铭牌 |

### 4.3 鱼的展示行为

```verse
fish_display_behavior := class:
    # 鱼在水缸中的行为
    IdleSwim() : void =
        # 缓慢来回游动
        # 偶尔改变方向
        # 贴近玩家时「看向」玩家
```

---

## 五、放置流程详解

### 5.1 放置新鱼

```
┌──────────────┐
│ 背包选中鱼   │
└──────────────┘
       │
       ▼
┌──────────────┐    ┌──────────────┐
│ 查询可用位置 │───▶│ 无可用位置   │──▶ 提示「展示位已满」
└──────────────┘    └──────────────┘
       │
       │ 有可用
       ▼
┌──────────────┐
│ 显示位置选择 │
└──────────────┘
       │
       │ 玩家选择
       ▼
┌──────────────┐
│ 执行放置     │
│ - 背包 -1    │
│ - 位置标记   │
│ - 生成模型   │
│ - 通知收益   │
└──────────────┘
       │
       ▼
┌──────────────┐
│ 播放动画     │
│ 显示成功提示 │
└──────────────┘
```

### 5.2 替换鱼

```
┌──────────────┐
│ 选择已占位置 │
└──────────────┘
       │
       ▼
┌──────────────┐
│ 显示操作选项 │
│ - 取回       │
│ - 替换       │
│ - 查看详情   │
└──────────────┘
       │
       │ 选择「替换」
       ▼
┌──────────────┐
│ 打开背包选择 │
└──────────────┘
       │
       │ 选择新鱼
       ▼
┌──────────────┐
│ 执行替换     │
│ - 旧鱼回背包 │
│ - 新鱼放置   │
│ - 更新收益   │
└──────────────┘
```

---

## 六、事件接口

### 6.1 接收事件

| 事件 | 来源 | 处理 |
|------|------|------|
| `OnTrophyPlaceRequest` | 战利品系统 | 验证并执行放置 |

### 6.2 发出事件

| 事件 | 触发条件 | 数据 |
|------|----------|------|
| `OnDisplayChanged` | 放置/移除/替换 | slotId, fishData |
| `OnSlotInteracted` | 玩家交互展示位 | slotId, action |

---

## 七、UI 设计

### 7.1 展示位选择界面

```
┌────────────────────────────────────────────────┐
│  选择展示位置                        [X] 取消  │
├────────────────────────────────────────────────┤
│                                                │
│    ┌────────┐   ┌────────┐   ┌────────┐       │
│    │  空位  │   │ 🐟草鱼 │   │  空位  │       │
│    │        │   │        │   │        │       │
│    │ [选择] │   │ [替换] │   │ [选择] │       │
│    └────────┘   └────────┘   └────────┘       │
│      位置 1       位置 2       位置 3          │
│                                                │
├────────────────────────────────────────────────┤
│  当前选中: 锦鲤 ⭐⭐⭐                          │
│  收益: 5 金币/秒                               │
└────────────────────────────────────────────────┘
```

### 7.2 展示位交互菜单

```
┌──────────────────┐
│  🐟 锦鲤         │
│  ⭐⭐⭐ 稀有      │
├──────────────────┤
│  📦 取回到背包   │
│  🔄 替换         │
│  📖 查看详情     │
└──────────────────┘
```

---

## 八、UEFN 实现要点

### 8.1 展示位 Device

```verse
display_slot_device := class(creative_device):
    @editable SlotId : int = 1
    @editable SlotPosition : vector3 = vector3{}
    
    var CurrentFish : ?fish_data = false
    var FishActor : ?creative_prop = false
    
    OnPlayerInteract(Player : agent) : void =
        if CurrentFish:
            ShowInteractionMenu(Player)
        else:
            OpenInventoryForPlacement(Player)
    
    PlaceFish(Fish : fish_data) : void =
        set CurrentFish = option{Fish}
        SpawnFishModel(Fish)
        NotifyIncomeSystem()
```

### 8.2 鱼模型生成

```verse
SpawnFishModel(Fish : fish_data) : void =
    # 根据 Fish.ModelRef 加载对应 Prop
    # 设置位置到水缸中心
    # 启动游动行为脚本
    # 根据稀有度设置灯光颜色
```

---

## 九、下一步

**基地系统机制设计完成** ✅

下一个系统：`@mechanics/income.md` - 收益系统机制

---

*文档生成时间：2025-12-26*
