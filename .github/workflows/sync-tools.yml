name: Sync Tools from Skills
# è‡ªåŠ¨æ”¶é›†æ‰€æœ‰ Skill ä¸‹çš„ tools åˆ° .github/tools/

on:
  push:
    paths:
      - 'Core/skills/**/tools/**'
  workflow_dispatch:

jobs:
  sync-tools:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Collect tools from Skills
        run: |
          echo "ğŸ“¦ æ”¶é›†æ‰€æœ‰ Skill ä¸‹çš„å·¥å…·..."
          
          # ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨
          mkdir -p .github/tools
          
          # æŸ¥æ‰¾æ‰€æœ‰ Skill ä¸‹çš„ tools ç›®å½•ä¸­çš„ .py æ–‡ä»¶
          find Core/skills -path "*/tools/*.py" | while read src; do
            filename=$(basename "$src")
            echo "  â†’ å¤åˆ¶ $src â†’ .github/tools/$filename"
            cp "$src" ".github/tools/$filename"
          done
          
          # æŸ¥æ‰¾æ‰€æœ‰ .sh æ–‡ä»¶
          find Core/skills -path "*/tools/*.sh" | while read src; do
            filename=$(basename "$src")
            echo "  â†’ å¤åˆ¶ $src â†’ .github/tools/$filename"
            cp "$src" ".github/tools/$filename"
          done
          
          echo "âœ… å·¥å…·æ”¶é›†å®Œæˆ"
      
      - name: Generate tools index
        run: |
          echo "ğŸ“ ç”Ÿæˆå·¥å…·ç´¢å¼•..."
          
          cat > .github/tools/INDEX.md << 'EOF'
          # CLI Tools ç´¢å¼•
          
          > æ­¤æ–‡ä»¶ç”± CI è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ç¼–è¾‘
          
          ## å¯ç”¨å·¥å…·
          
          | å·¥å…· | æ¥æº Skill | è¯´æ˜ |
          |------|-----------|------|
          EOF
          
          # è§£ææ¯ä¸ª .py æ–‡ä»¶çš„ docstring ç”Ÿæˆç´¢å¼•
          for tool in .github/tools/*.py; do
            if [ -f "$tool" ]; then
              name=$(basename "$tool" .py)
              # æå–ç¬¬ä¸€è¡Œ docstring ä½œä¸ºè¯´æ˜
              desc=$(grep -m1 '"""' -A1 "$tool" | tail -1 | sed 's/^[[:space:]]*//')
              # æŸ¥æ‰¾æ¥æº
              source=$(find Core/skills -name "$(basename $tool)" -path "*/tools/*" | head -1 | sed 's|Core/skills/||' | sed 's|/tools/.*||')
              echo "| \`$name\` | $source | $desc |" >> .github/tools/INDEX.md
            fi
          done
          
          echo "âœ… ç´¢å¼•ç”Ÿæˆå®Œæˆ"
      
      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add .github/tools/
          
          if git diff --staged --quiet; then
            echo "ğŸ“­ æ²¡æœ‰éœ€è¦åŒæ­¥çš„æ›´æ”¹"
          else
            git commit -m "chore: sync tools from Skills [skip ci]"
            git push
            echo "âœ… å·¥å…·å·²åŒæ­¥"
          fi
