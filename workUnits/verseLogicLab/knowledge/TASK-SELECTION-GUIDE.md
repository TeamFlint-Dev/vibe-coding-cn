# 任务选择指南
# Task Selection Guide

> **目标**: 根据价值、影响力和可行性，智能选择最有价值的任务执行  
> **原则**: 价值优先、知识增长、快速见效、稳健推进

---

## 📊 任务价值评估矩阵

### 评估维度

| 维度 | 权重 | 说明 |
|------|------|------|
| **知识增长** | 30% | 该任务能带来多少新知识/验证多少猜想 |
| **复用价值** | 25% | 产出模块被其他任务/项目使用的频率 |
| **依赖解锁** | 20% | 完成后能解锁多少其他任务 |
| **难度适中** | 15% | 不过于简单也不过于复杂 |
| **知识沉淀** | 10% | 能产生多少可记录的模式/决策/经验 |

### 评分标准

- **高价值 (8-10分)**: 立即执行，优先级最高
- **中高价值 (6-7分)**: 近期执行，推荐优先
- **中等价值 (4-5分)**: 按计划执行
- **低价值 (1-3分)**: 延后或跳过

---

## 🎯 当前推荐任务清单

### 🔴 第一优先级：立即可执行的高价值任务

#### 1. TASK-003: 浮点数比较与容差 (Float Comparison) ⭐⭐⭐

**价值评分**: 9/10

**理由**:
- ✅ **知识增长**: 验证 CONJ-003 (已证伪，需要正确实现)
- ✅ **复用价值**: 几乎所有数值计算模块都需要
- ✅ **依赖解锁**: 解锁后续所有涉及浮点比较的任务
- ✅ **难度适中**: 清晰的实现方案，容易验证
- ✅ **知识沉淀**: 可记录浮点精度处理的最佳实践

**执行要点**:
- 参考现有的 `MathFloatComparison.verse`（如果存在）
- 使用标准的 epsilon 比较方法
- 测试边界情况：0.0, 极小值, 极大值
- 验证与 CONJ-003 的关系

**预期产出**:
- 可复用的浮点比较函数库
- 验证并更新 CONJ-003 状态
- 记录到 PATTERNS.md: "浮点数安全比较模式"
- 更新 DECISION_RECORDS.md: "为什么选择 epsilon = 0.0001"

---

#### 2. TASK-001: 安全数学运算库 (SafeMath) ⭐⭐⭐

**价值评分**: 9/10

**理由**:
- ✅ **知识增长**: 深入理解 Verse 的数值边界和错误处理
- ✅ **复用价值**: 所有数值计算的安全保障
- ✅ **依赖解锁**: 为后续所有数学模块提供安全基础
- ✅ **难度适中**: 明确的需求，标准的实现模式
- ✅ **知识沉淀**: 验证 `<decides>` 效果在数值运算中的使用

**执行要点**:
- 重点处理除零、溢出、下溢
- 使用 `<decides>` 效果优雅失败
- 研究 Verse 的整数和浮点数边界
- 可能验证 CONJ-002 (效果系统)

**预期产出**:
- SafeAdd, SafeSubtract, SafeMultiply, SafeDivide, SafePower
- 验证 CONJ-002 关于 `<decides>` 和 `<transacts>` 的理解
- 记录到 COMPILATION_LESSONS.json: 数值边界处理经验
- 创建 ADR: "安全数学运算的错误处理策略"

---

#### 3. TASK-023: 数组查询 (Array Queries) ⭐⭐

**价值评分**: 8/10

**理由**:
- ✅ **知识增长**: 验证 option[T] 的使用 (CONJ-004, 005, 006, 007)
- ✅ **复用价值**: 数组操作的基础工具
- ✅ **依赖解锁**: 为后续集合操作提供基础
- ✅ **难度适中**: 逻辑清晰，但需要正确使用 option
- ✅ **知识沉淀**: 验证 option 类型的所有猜想

**执行要点**:
- Contains, IndexOf, LastIndexOf, FindAll, Count, Any, All
- 重点使用 option[int] 和 option[T]
- 验证 CONJ-004-007 (option 类型系列猜想)
- 参考 RESEARCH-003: option[T] 类型深度研究

**预期产出**:
- 完整的数组查询函数库
- 验证 CONJ-004, 005, 006, 007 的状态
- 记录到 PATTERNS.md: "option[T] 使用模式"
- 更新 SOURCES.md: 引用官方文档和调研报告

---

#### 4. TASK-081: 数值范围验证 (Range Validation) ⭐⭐

**价值评分**: 8/10

**理由**:
- ✅ **知识增长**: 实践 `<decides>` 效果在验证场景的使用
- ✅ **复用价值**: 所有需要输入验证的场景
- ✅ **依赖解锁**: 为验证工具集提供基础
- ✅ **难度适中**: 简单但重要
- ✅ **知识沉淀**: 验证函数的标准模式

**执行要点**:
- IsInRange, IsPositive, IsNonNegative, IsBetween, ValidateRange
- 使用 `<decides>` 效果
- 考虑边界包含性（开区间 vs 闭区间）
- 测试边界值

**预期产出**:
- 可复用的验证函数集
- 记录到 PATTERNS.md: "验证函数的标准签名"
- 更新 DECISION_RECORDS.md: "验证失败的返回策略"

---

### 🟡 第二优先级：近期推荐执行

#### 5. TASK-002: 数值范围映射 (Range Mapping) ⭐⭐

**价值评分**: 7/10

- ✅ 高复用价值（UI、音量、属性转换）
- ✅ 依赖 TASK-001 (SafeMath) 和 TASK-003 (Float Comparison)
- ✅ 可记录"范围映射的标准模式"

#### 6. TASK-021: 数组切片与分块 (Array Slicing) ⭐⭐

**价值评分**: 7/10

- ✅ 数组操作的基础工具
- ✅ 可能遇到并验证新的编译错误
- ✅ 为后续集合任务提供基础

#### 7. TASK-022: 数组过滤与映射 (Array Filtering) ⭐⭐⭐

**价值评分**: 8/10

- ✅ **知识增长**: 需要调研 Verse 是否支持高阶函数
- ✅ 高难度但高价值
- ✅ 可能创建 RESEARCH-XXX: Verse 高阶函数支持
- ⚠️ **前置条件**: 需要先调研 Verse 函数式编程支持

---

### 🟢 第三优先级：按计划执行

#### 8. TASK-004: 数学常量库 (Math Constants)

**价值评分**: 6/10

- ✅ 简单但有用
- ⚠️ 需要调研 Verse 中常量的定义方式
- 可能创建 RESEARCH-XXX: Verse 常量定义规范

#### 9. TASK-082-085: 其他验证函数

**价值评分**: 6/10

- ✅ 补充验证工具集
- 依赖 TASK-081 的模式

---

## 🔍 任务依赖图

```
Phase 0 前置调研任务:
  ├─ RESEARCH-XXX: Verse 高阶函数支持 → 解锁 TASK-022
  ├─ RESEARCH-XXX: Verse 常量定义规范 → 解锁 TASK-004
  └─ (已完成) RESEARCH-003: option[T] → 已解锁 TASK-023

P0 核心基础任务:
  ├─ TASK-003: Float Comparison (立即可执行)
  ├─ TASK-001: SafeMath (立即可执行)
  ├─ TASK-023: Array Queries (立即可执行，依赖 RESEARCH-003)
  ├─ TASK-081: Range Validation (立即可执行)
  ├─ TASK-002: Range Mapping (依赖 001, 003)
  ├─ TASK-021: Array Slicing (依赖 023)
  ├─ TASK-022: Array Filtering (需要前置调研)
  └─ TASK-004: Math Constants (需要前置调研)
```

---

## 📋 推荐执行顺序

### Week 1: 核心数学基础 + 快速知识增长

**Day 1-2: TASK-003 Float Comparison**
- 立即可执行，无前置依赖
- 验证已证伪的 CONJ-003
- 为后续所有数学任务提供基础

**Day 3-4: TASK-001 SafeMath**
- 依赖 TASK-003 的比较函数
- 验证 CONJ-002 (效果系统)
- 建立安全计算模式

**Day 5: 前置调研 - Verse 高阶函数支持**
- 调研 Verse 是否支持函数作为参数
- 如果支持，如何传递函数
- 如果不支持，如何用替代方案实现 Filter/Map
- 创建 RESEARCH-XXX: Verse 函数式编程支持

**Day 6-7: TASK-023 Array Queries**
- 依赖 RESEARCH-003 (已完成)
- 验证 CONJ-004, 005, 006, 007
- 实践 option[T] 的正确用法

**里程碑**: Week 1 完成 3 个任务 + 1 个调研

---

### Week 2: 验证与集合操作

**Day 1-2: TASK-081 Range Validation**
- 建立验证函数的标准模式
- 实践 `<decides>` 效果

**Day 3-4: TASK-021 Array Slicing**
- 依赖 TASK-023 的模式
- 补充数组操作工具集

**Day 5-6: TASK-022 Array Filtering (如果调研结果支持)**
- 依赖 Week 1 的高阶函数调研
- 如果不支持高阶函数，使用替代方案
- 可能需要创新性解决方案

**Day 7: TASK-002 Range Mapping**
- 依赖 TASK-001 和 TASK-003
- 综合应用已有模块

**里程碑**: Week 2 完成 4 个任务

---

## 🎓 知识增长路线图

### Week 1 知识增长目标

1. **验证猜想**:
   - ✅ CONJ-003 (已证伪，正确实现)
   - ✅ CONJ-002 (效果系统)
   - ✅ CONJ-004, 005, 006, 007 (option 类型)

2. **新增调研**:
   - ✅ RESEARCH-XXX: Verse 高阶函数支持

3. **知识沉淀**:
   - ✅ 至少 3 个新 ADR
   - ✅ 至少 5 个新 Pattern
   - ✅ 至少 3 个新 Compilation Lesson

4. **猜想库清理**:
   - ✅ 将 5+ 个猜想从 Unverified → Verified/Disproven

---

## ⚠️ 风险与缓解

### 风险 1: Verse 不支持高阶函数

**影响**: TASK-022 (Array Filtering) 无法按计划实现

**缓解**:
- Day 5 提前调研
- 如果不支持，设计替代方案：
  - 方案 A: 使用预定义的谓词枚举
  - 方案 B: 使用字符串表达式 + 解释器模式
  - 方案 C: 为每种常见过滤条件创建专用函数

**决策点**: 调研完成后立即决定

---

### 风险 2: 编译错误超出预期

**影响**: 任务完成时间延长

**缓解**:
- 每个任务留出 20% 的调试时间缓冲
- 遇到新错误立即记录到 COMPILATION_LESSONS.json
- 如果卡住超过 2 小时，暂停并创建 Issue

---

### 风险 3: 猜想验证失败

**影响**: 需要重新设计实现方案

**缓解**:
- Phase -1 强制审查猜想库
- 优先使用已验证的知识
- 遇到猜想冲突时，查阅官方文档

---

## 📊 成功指标

### Week 1 成功标准

- ✅ 完成 3 个 P0 任务
- ✅ 完成 1 个前置调研
- ✅ 验证 5+ 个猜想
- ✅ 新增 3+ ADR
- ✅ 新增 5+ Pattern
- ✅ 所有任务编译通过 (0 错误)

### Week 2 成功标准

- ✅ 完成 4 个 P0 任务
- ✅ P0 任务完成率达到 38% (7/18)
- ✅ 猜想库中 Unverified 项减少至少 50%
- ✅ 知识资产更新率 100% (每个任务至少 2 个)

---

## 🔄 动态调整策略

### 每周评估

- **周五下午**: 评估本周完成情况
- **调整标准**:
  - 如果完成率 < 80%，下周减少 1 个任务
  - 如果完成率 > 100%，下周增加 1 个任务
  - 如果遇到重大技术障碍，重新规划

### 灵活性原则

- ✅ 如果发现高价值的知识缺口，允许插入调研任务
- ✅ 如果某个任务难度超出预期，允许拆分为多个子任务
- ✅ 如果发现更高价值的任务，允许调整顺序

---

## 📚 参考资料

- **任务详情**: `logic-module-development-plan-phase1.md`
- **任务索引**: `TASK-QUICKREF.md`
- **猜想库**: `CONJECTURES.md`
- **知识缺口**: `knowledge-gaps.md`
- **改进积压**: `improvement-backlog.md`

---

**创建日期**: 2026-01-13  
**下次更新**: 每周五评估后更新

---

**记住**: 选择任务的目标不仅是完成代码，更重要的是知识增长和能力提升。宁可少做几个任务，也要确保每个任务都有深度的思考和充分的知识沉淀。
