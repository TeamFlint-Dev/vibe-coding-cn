# 代谢主体

代谢系统由三个 Agent 角色组成，形成"生产 → 提炼 → 演化"的流水线。

## 角色概览

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   创建者    │ ──▶ │   审计者    │ ──▶ │   重构者    │
│ (执行Agent) │     │ (提炼Agent) │     │ (演化Agent) │
└─────────────┘     └─────────────┘     └─────────────┘
      │                   │                   │
      ▼                   ▼                   ▼
   行为痕迹            信号提取            Skill 演化
```

## 创建者（Creator）

### 职责

创建者是真正执行任务的 Agent。它：

- 读取 Skill 获取上下文
- 执行用户任务
- 产生行为痕迹（自然产物）
- 遇到阻力时主动发送信号（可选）

### 行为痕迹

创建者的所有行为都会被记录在 GitHub Actions 日志中：

| 痕迹类型 | 内容 |
|----------|------|
| 文件读取 | 读取了哪些 Skill、哪些文件 |
| 文件写入 | 创建或修改了什么 |
| 思考过程 | Agent 的推理链 |
| 遇到的问题 | 错误、回退、犹豫 |

### 主动发送信号

当创建者遇到阻力时，可以主动分析根因并发送信号：

```markdown
## 信号发送时机

- 找不到合适的 Skill
- Skill 内容与实际不符
- 在多个 Skill 间反复切换
- 示例代码无法运行
- 依赖的上下文缺失
```

主动信号比被动提取更准确，因为创建者拥有完整的执行上下文。

## 审计者（Auditor）

### 职责

审计者从行为痕迹中提取有价值的信号：

- 读取 GitHub Actions 日志
- 识别失败、回退、犹豫模式
- 归因到具体的 Skill
- 生成半结构化信号
- 合并重复信号

### 信号提取

审计者不需要预定义的信号类型模板，而是从痕迹中**发现**问题：

```
日志片段                          →  提取的信号
─────────────────────────────────────────────────────
"在 A 和 B 之间切换了 3 次"       →  boundary-unclear
"示例代码编译失败"                →  content-outdated
"找不到网络同步相关内容"          →  capability-missing
"加载了 Skill 但没有使用"         →  potentially-redundant
```

### 与重构日志的交互

审计者也会读取重构日志，学习：

- 哪些重构是有效的
- 哪些重构导致了新问题
- 如何更准确地归因

## 重构者（Refactorer / Evolver）

### 职责

重构者根据信号模式执行代谢动作：

- 读取信号池
- 识别需要处理的信号模式
- 执行代谢动作（更新/拆分/合并/废弃等）
- 记录重构日志
- 自我优化重构策略

### 代谢决策

重构者根据信号的 `type` 和累积 `count` 决定动作：

| 信号类型 | 累积阈值 | 代谢动作 |
|----------|----------|----------|
| `outdated` | 2+ | 更新内容 |
| `unclear` | 3+ | 锐化边界 |
| `missing` | 3+ | 新建 Skill |
| `conflict` | 2+ | 合并或划界 |
| `overload` | 2+ | 拆分 |
| `unused` | 持续 30 天 | 废弃 |

### 重构日志

每次重构都应记录：

```markdown
## 重构记录 - 2026-01-02

### 触发信号
- target: verseDev/verseComponent
- type: outdated
- count: 3
- evidences:
  - "示例代码在 UEFN 5.x 无法编译"
  - "组件模板缺少新 API"
  - "参考的 Fortnite API 已废弃"

### 执行动作
更新 verseComponent 的示例代码，同步 UEFN 5.x API

### 变更内容
- 更新 SKILL.md 示例章节
- 更新 templates/component-template.verse

### 待观察
下次使用时观察是否还有 outdated 信号
```

## 协作模式

```
用户请求
    │
    ▼
┌─────────────┐
│   创建者    │ ──── 执行任务 ────▶ 行为痕迹（GitHub Actions）
└─────────────┘                           │
      │                                   │
      │ 遇到阻力                          │ 定期读取
      │ 主动发信号                        │
      ▼                                   ▼
┌──────────────────────────────────────────────┐
│                  信号池                       │
│              (GitHub Issues)                 │
└──────────────────────┬───────────────────────┘
                       │
                       │ 阈值触发
                       ▼
                ┌─────────────┐
                │   审计者    │ ──── 补充信号提取
                └──────┬──────┘
                       │
                       ▼
                ┌─────────────┐
                │   重构者    │ ──── 执行代谢 ────▶ 重构日志
                └──────┬──────┘                        │
                       │                               │
                       ▼                               │
                ┌─────────────┐                        │
                │  Skill 池   │◀───────────────────────┘
                │  (更新后)   │      审计者/重构者学习
                └─────────────┘
```

## 元 Skill 的实现位置

代谢主体应作为真正的 Skill 实现在 `Core/skills/` 中：

```
skills/
├── skillCreator/           # 创建者 Skill
│   └── SKILL.md
├── skillAuditor/           # 审计者 Skill
│   ├── SKILL.md
│   └── checklists/
└── skillRefactorer/        # 重构者 Skill
    └── SKILL.md
```

---

**相关文档**：

- [信号机制](信号机制.md)
- [代谢动作](代谢动作.md)
- [调度规则](调度规则.md)
