# Verse Agent Loop - å…¨è‡ªåŠ¨ç¼–ç å¾ªç¯æ§åˆ¶å™¨

> **ç‰ˆæœ¬**: 1.0.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-12-29  
> **ç±»å‹**: å¾ªç¯æ§åˆ¶å™¨Skill (Loop Controller Skill)

---

## æ¦‚è¿°

**Verse Agent Loop** æ˜¯ä¸€ä¸ªè„šæœ¬é©±åŠ¨çš„å…¨è‡ªåŠ¨ç¼–ç å¾ªç¯ç³»ç»Ÿï¼Œé€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨å¤šä¸ª Copilot Agentï¼ˆBackground Agent / Codexï¼‰å®ç°"éœ€æ±‚â†’ç¼–ç â†’ç¼–è¯‘éªŒè¯â†’å¤šAgentè¯„å®¡â†’GitæŠ•ç¥¨â†’æˆ˜æœ¯æ‰‹å†Œæ›´æ–°"çš„å®Œæ•´é—­ç¯ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **è„šæœ¬ç¼–æ’**: Pythonä¸»æ§è„šæœ¬é©±åŠ¨æ•´ä¸ªæµç¨‹
- **ç¼–è¯‘éªŒè¯**: é›†æˆ verseCliï¼Œç¼–è¯‘é€šè¿‡æ‰ç®—å®Œæˆ
- **å¤šAgentè¯„å®¡**: ä¸‰ä¸ªè¯„å®¡Agentå¹¶è¡ŒæŠ•ç¥¨ï¼ˆå®ç”¨æ€§40%ã€æ¡†æ¶40%ã€è´¨é‡20%ï¼‰
- **GitæŠ•ç¥¨**: é€šè¿‡ git notes å®ç°åŒæ„/å¦å†³æœºåˆ¶
- **æˆ˜æœ¯æ‰‹å†Œ**: ç»“æ„åŒ–é”™è¯¯å½’å¹¶ï¼ŒæŒç»­æ”¹è¿›
- **åŒæ¨¡å¼**: æ ¡å‡†æ¨¡å¼ï¼ˆäººå·¥ç¡®è®¤ï¼‰+ å…¨è‡ªåŠ¨æ¨¡å¼

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     main.py (ä¸»æ§è„šæœ¬)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ å¯åŠ¨é…ç½®    â”‚â†’â”‚ éœ€æ±‚é˜Ÿåˆ—ç®¡ç† â”‚â†’â”‚ å¾ªç¯æ§åˆ¶    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                    â–¼                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚              ç¼–ç Agent (Gitåˆ†æ”¯å·¥ä½œ)               â”‚  â”‚
        â”‚  â”‚  1. è¯»å–éœ€æ±‚ + æ³¨å…¥æˆ˜æœ¯æ‰‹å†Œ                        â”‚  â”‚
        â”‚  â”‚  2. ç”Ÿæˆä»£ç                                        â”‚  â”‚
        â”‚  â”‚  3. è°ƒç”¨ verse-build.js ç¼–è¯‘éªŒè¯                   â”‚  â”‚
        â”‚  â”‚  4. è¾“å‡ºç»“æ„åŒ–é”™è¯¯JSON                             â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                          â”‚ ç¼–è¯‘é€šè¿‡                     â”‚
        â”‚                          â–¼                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚           è¯„å®¡Agents (å¹¶è¡Œ, GitæŠ•ç¥¨)               â”‚  â”‚
        â”‚  â”‚  A. å®ç”¨æ€§å®¡è®¡ (40%) - åŠŸèƒ½å®Œæ•´æ€§ã€è¾¹ç•Œå¤„ç†        â”‚  â”‚
        â”‚  â”‚  B. æ¡†æ¶ç¬¦åˆæ€§ (40%) - åˆ†å±‚è§„èŒƒã€äº‹ä»¶æ–¹å‘          â”‚  â”‚
        â”‚  â”‚  C. ä»£ç è´¨é‡ (20%) - å‘½åã€é‡å¤ã€èŒè´£              â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                          â”‚ æŠ•ç¥¨é€šè¿‡/å¦å†³                â”‚
        â”‚                          â–¼                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚              Git åˆå¹¶ / é‡è¯• / å‡çº§                 â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                          â”‚                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ é”™è¯¯é˜Ÿåˆ—
                                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              Tactician Agent (æˆ˜æœ¯æ‰‹å†Œç»´æŠ¤)               â”‚
        â”‚  æ¥æ”¶ç»“æ„åŒ–ä¸ŠæŠ¥ â†’ æ ¹æºå½’å¹¶ â†’ æ›´æ–°æ‰‹å†Œ â†’ Git commit        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç›®å½•ç»“æ„

```
verseAgentLoop/
â”œâ”€â”€ SKILL.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ main.py                 # ä¸»æ§è„šæœ¬
â”‚   â”œâ”€â”€ agents.py               # Agentè°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ compiler.py             # verseCli é›†æˆ
â”‚   â”œâ”€â”€ git_manager.py          # Gitæ“ä½œå°è£…
â”‚   â”œâ”€â”€ tactician.py            # Tacticianè°ƒç”¨
â”‚   â”œâ”€â”€ utils.py                # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ search_logs.py          # æ—¥å¿—æ£€ç´¢å·¥å…·
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ default.json            # é»˜è®¤é…ç½®
â”‚   â””â”€â”€ schema.json             # é…ç½®Schema
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ active/                 # æœ€è¿‘20ä¸ªéœ€æ±‚çš„æ—¥å¿—
â”‚   â”œâ”€â”€ archive/                # æŒ‰æœˆå½’æ¡£ (YYYY-MM/)
â”‚   â””â”€â”€ escalation/             # å‡çº§æ—¥å¿—ï¼ˆæ°¸ä¹…ä¿ç•™ï¼‰
â”œâ”€â”€ reports/                    # è¿è¡ŒæŠ¥å‘Š
â””â”€â”€ prompts/                    # Agentæç¤ºè¯æ¨¡æ¿
    â”œâ”€â”€ coding_agent.md         # ç¼–ç Agentæç¤ºè¯
    â”œâ”€â”€ reviewer_utility.md     # å®ç”¨æ€§è¯„å®¡æç¤ºè¯
    â”œâ”€â”€ reviewer_framework.md   # æ¡†æ¶è¯„å®¡æç¤ºè¯
    â””â”€â”€ reviewer_quality.md     # è´¨é‡è¯„å®¡æç¤ºè¯
```

---

## å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

1. **Python** >= 3.9
2. **Node.js** >= 14 (verseCliä¾èµ–)
3. **UEFN** å·²æ‰“å¼€å¹¶åŠ è½½é¡¹ç›®
4. **Copilot CLI** æˆ–é…ç½®å¥½çš„ OpenAI Codex API

### å®‰è£…ä¾èµ–

```bash
cd Core/skills/programming/verseDev/verseAgentLoop/scripts
pip install -r requirements.txt
```

### å¯åŠ¨å¾ªç¯

```bash
# æ ¡å‡†æ¨¡å¼ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰
python main.py --calibration

# å…¨è‡ªåŠ¨æ¨¡å¼
python main.py

# ä»ä¸Šæ¬¡ä¸­æ–­æ¢å¤
python main.py --resume
```

---

## å‘½ä»¤è¡Œé€‰é¡¹

| é€‰é¡¹ | ç¼©å†™ | æè¿° | é»˜è®¤å€¼ |
|------|------|------|--------|
| `--calibration` | `-c` | æ ¡å‡†æ¨¡å¼ï¼Œå‰3ä¸ªéœ€æ±‚äººå·¥ç¡®è®¤ | false |
| `--resume` | `-r` | ä»æ£€æŸ¥ç‚¹æ¢å¤ | false |
| `--max-tasks` | `-n` | å®Œæˆå¤šå°‘ä¸ªéœ€æ±‚ååœæ­¢ | 5 |
| `--auto-generate` | `-g` | éœ€æ±‚é˜Ÿåˆ—ç©ºæ—¶è‡ªåŠ¨ç”Ÿæˆæ–°éœ€æ±‚ | false |
| `--escalation-threshold` | `-e` | è¿ç»­å¦å†³å¤šå°‘æ¬¡åå‡çº§ | 3 |
| `--config` | | æŒ‡å®šé…ç½®æ–‡ä»¶ | config/default.json |
| `--verbose` | `-v` | è¯¦ç»†æ—¥å¿— | false |

### ç¤ºä¾‹

```bash
# å®Œæˆ10ä¸ªéœ€æ±‚ï¼Œå¯ç”¨è‡ªåŠ¨ç”Ÿæˆ
python main.py -n 10 -g

# æ ¡å‡†æ¨¡å¼ï¼Œè¯¦ç»†æ—¥å¿—
python main.py --calibration --verbose

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
python main.py --config config/my-config.json
```

---

## é…ç½®æ–‡ä»¶

### config/default.json

```json
{
  "version": "1.0.0",
  
  "loop": {
    "max_tasks": 5,
    "auto_generate_requirements": false,
    "requirement_queue_threshold": 2,
    "escalation_threshold": 3
  },
  
  "compile": {
    "max_attempts": 3,
    "verse_cli_path": "../verseCli/verse-build.js"
  },
  
  "review": {
    "weights": {
      "utility": 0.4,
      "framework": 0.4,
      "quality": 0.2
    },
    "pass_threshold": 7.0,
    "require_no_critical": true
  },
  
  "tactician": {
    "calibration_frequency": 1,
    "auto_frequency": 5,
    "skip_if_no_updates": true
  },
  
  "agent": {
    "provider": "copilot",
    "model": "gpt-4",
    "timeout": 300,
    "retry_attempts": 2
  },
  
  "git": {
    "auto_commit": true,
    "branch_prefix": "agent-loop",
    "main_branch": "main"
  },
  
  "logs": {
    "active_limit": 20,
    "archive_by": "month"
  }
}
```

---

## è¿è¡Œæ¨¡å¼

### æ ¡å‡†æ¨¡å¼ (--calibration)

1. å‰Nä¸ªéœ€æ±‚ï¼ˆé»˜è®¤3ä¸ªï¼‰**äººå·¥ç¡®è®¤**
2. æ¯ä¸ªéœ€æ±‚å®Œæˆåæš‚åœï¼Œå±•ç¤ºï¼š
   - ç”Ÿæˆçš„ä»£ç 
   - ç¼–è¯‘ç»“æœ
   - è¯„å®¡æ„è§
   - æ‹Ÿå½’å¹¶çš„æ ¹æº
3. ç”¨æˆ·ç¡®è®¤"ç¬¦åˆé¢„æœŸ"åç»§ç»­
4. æ¯ä¸ªéœ€æ±‚åç«‹å³è°ƒç”¨ Tactician æ›´æ–°æ‰‹å†Œ
5. æ ¡å‡†é€šè¿‡åè‡ªåŠ¨åˆ‡æ¢å…¨è‡ªåŠ¨æ¨¡å¼

**é€‚ç”¨åœºæ™¯**: é¦–æ¬¡è¿è¡Œã€æ›´æ¢é¡¹ç›®ã€è°ƒè¯•é—®é¢˜

### å…¨è‡ªåŠ¨æ¨¡å¼ (é»˜è®¤)

1. æ— äººå€¼å®ˆè¿è¡Œ
2. æ¯5ä¸ªéœ€æ±‚æ‰¹é‡è°ƒç”¨ Tactician
3. é‡åˆ°å‡çº§æƒ…å†µè‡ªåŠ¨è®°å½•å¹¶ç»§ç»­
4. è¾¾åˆ°é€€å‡ºæ¡ä»¶æ—¶åœæ­¢å¹¶ç”ŸæˆæŠ¥å‘Š

**é€‚ç”¨åœºæ™¯**: å·²éªŒè¯è´¨é‡ï¼Œå¤§è§„æ¨¡è¿è¡Œ

---

## å•éœ€æ±‚å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ä» @pending-requirements.md å–å‡ºä¸€ä¸ªéœ€æ±‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. åˆ›å»º Git åˆ†æ”¯: agent-loop/REQ-YYYYMMDD-NNN             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. è°ƒç”¨ç¼–ç Agent                                           â”‚
â”‚     - æ³¨å…¥: éœ€æ±‚æè¿° + æˆ˜æœ¯æ‰‹å†Œ(é«˜é¢‘æ ¹æº) + ä»£ç åº“ä¸Šä¸‹æ–‡    â”‚
â”‚     - è¾“å‡º: ä»£ç æ–‡ä»¶ + ç»“æ„åŒ–é”™è¯¯JSON                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ç¼–è¯‘éªŒè¯å¾ªç¯ (æœ€å¤š3æ¬¡)                                   â”‚
â”‚     node verse-build.js                                     â”‚
â”‚     - æˆåŠŸ(é€€å‡ºç 0) â†’ ç»§ç»­                                  â”‚
â”‚     - å¤±è´¥(é€€å‡ºç 1) â†’ è§£æé”™è¯¯ï¼Œè°ƒç”¨Agentä¿®å¤ï¼Œé‡è¯•         â”‚
â”‚     - 3æ¬¡å¤±è´¥ â†’ æ ‡è®°ç¼–è¯‘å¤±è´¥ï¼Œè¿›å…¥è¯„å®¡                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å¹¶è¡Œè°ƒç”¨ä¸‰ä¸ªè¯„å®¡Agent                                    â”‚
â”‚     - reviewer-utility: å®ç”¨æ€§å®¡è®¡ (40%æƒé‡)                â”‚
â”‚     - reviewer-framework: æ¡†æ¶ç¬¦åˆæ€§ (40%æƒé‡)              â”‚
â”‚     - reviewer-quality: ä»£ç è´¨é‡ (20%æƒé‡)                  â”‚
â”‚     - è¾“å‡º: ç»“æ„åŒ–åé¦ˆJSON + Git notesæŠ•ç¥¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. æŠ•ç¥¨ç»Ÿè®¡                                                 â”‚
â”‚     åŠ æƒåˆ†æ•° = Î£(è¯„å®¡åˆ†æ•° Ã— æƒé‡)                           â”‚
â”‚     é€šè¿‡æ¡ä»¶: åˆ†æ•° >= 7.0 ä¸” æ— ğŸ”´ä¸¥é‡é—®é¢˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                           â”‚
            â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æŠ•ç¥¨é€šè¿‡      â”‚           â”‚ æŠ•ç¥¨å¦å†³      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                           â”‚
            â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Git åˆå¹¶åˆ°    â”‚           â”‚ å¦å†³æ¬¡æ•° < 3? â”‚
    â”‚ main åˆ†æ”¯     â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ æ ‡è®°éœ€æ±‚å®Œæˆ  â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   â”‚
                              â–¼                   â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ æ˜¯: åé¦ˆé—®é¢˜  â”‚   â”‚ å¦: å‡çº§å¤„ç†  â”‚
                      â”‚ ç»™ç¼–ç Agent   â”‚   â”‚ åˆ›å»ºå‡çº§æ—¥å¿—  â”‚
                      â”‚ é‡æ–°å¼€å§‹      â”‚   â”‚ æ ‡è®°NEEDS_HUMANâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ ç»§ç»­ä¸‹ä¸€éœ€æ±‚  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Agent è°ƒç”¨æ–¹å¼

### ä½¿ç”¨ Copilot Background Agent

```python
import subprocess

def call_copilot_agent(prompt: str, working_dir: str) -> str:
    """é€šè¿‡ Copilot CLI è°ƒç”¨ Background Agent"""
    result = subprocess.run(
        ["copilot", "agent", "--prompt", prompt, "--workdir", working_dir],
        capture_output=True,
        text=True,
        timeout=300
    )
    return result.stdout
```

### ä½¿ç”¨ OpenAI Codex API

```python
import openai

def call_codex_agent(prompt: str, context_files: list) -> str:
    """é€šè¿‡ OpenAI Codex API è°ƒç”¨"""
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": load_system_prompt()},
            {"role": "user", "content": prompt}
        ],
        max_tokens=4096
    )
    return response.choices[0].message.content
```

### é…ç½®åˆ‡æ¢

åœ¨ `config/default.json` ä¸­è®¾ç½®:

```json
{
  "agent": {
    "provider": "copilot",  // æˆ– "openai"
    "model": "gpt-4",
    "api_key_env": "OPENAI_API_KEY"  // ä»… openai éœ€è¦
  }
}
```

---

## ç»“æ„åŒ–è¾“å‡ºè¦æ±‚

### ç¼–ç Agentå¿…é¡»è¾“å‡º

```json
{
  "task_id": "REQ-20251229-001",
  "agent": "coding",
  "compile_attempts": 2,
  "compile_success": true,
  "errors": [...],
  "should_update_handbook": true
}
```

### è¯„å®¡Agentå¿…é¡»è¾“å‡º

```json
{
  "task_id": "REQ-20251229-001",
  "agent": "reviewer-utility",
  "verdict": "approve",
  "score": 8,
  "issues": [...],
  "should_update_handbook": false
}
```

è¯¦è§ [shared/tactical-schema.md](../shared/tactical-schema.md)

---

## æ—¥å¿—ç»“æ„

### æ´»è·ƒæ—¥å¿— (logs/active/)

```
active/
â”œâ”€â”€ REQ-20251229-001/
â”‚   â”œâ”€â”€ task.json           # ä»»åŠ¡å…ƒæ•°æ®
â”‚   â”œâ”€â”€ coding.log          # ç¼–ç Agentæ—¥å¿—
â”‚   â”œâ”€â”€ compile-1.log       # ç¬¬1æ¬¡ç¼–è¯‘æ—¥å¿—
â”‚   â”œâ”€â”€ compile-2.log       # ç¬¬2æ¬¡ç¼–è¯‘æ—¥å¿—
â”‚   â”œâ”€â”€ review-utility.json # å®ç”¨æ€§è¯„å®¡ç»“æœ
â”‚   â”œâ”€â”€ review-framework.json
â”‚   â”œâ”€â”€ review-quality.json
â”‚   â””â”€â”€ result.json         # æœ€ç»ˆç»“æœ
â”œâ”€â”€ REQ-20251229-002/
â”‚   â””â”€â”€ ...
â””â”€â”€ current.log             # å®æ—¶è¿è¡Œæ—¥å¿—
```

### å½’æ¡£æ—¥å¿— (logs/archive/)

```
archive/
â””â”€â”€ 2025-12/
    â”œâ”€â”€ REQ-20251228-001/
    â”œâ”€â”€ REQ-20251228-002/
    â””â”€â”€ ...
```

### å‡çº§æ—¥å¿— (logs/escalation/)

```
escalation/
â””â”€â”€ REQ-20251229-003/
    â”œâ”€â”€ task.json           # éœ€æ±‚æè¿°
    â”œâ”€â”€ attempts/           # 3æ¬¡å°è¯•çš„å®Œæ•´è®°å½•
    â”‚   â”œâ”€â”€ attempt-1/
    â”‚   â”œâ”€â”€ attempt-2/
    â”‚   â””â”€â”€ attempt-3/
    â”œâ”€â”€ summary.md          # å¤±è´¥æ‘˜è¦ï¼ˆä¾›äººå·¥é˜…è¯»ï¼‰
    â””â”€â”€ resolution.md       # äººå·¥è§£å†³åå¡«å†™
```

---

## æ£€ç´¢æ—¥å¿—

```bash
# æŒ‰å…³é”®è¯æ£€ç´¢
python scripts/search_logs.py --keyword "äº‹ä»¶æ–¹å‘" --last 7d

# æŒ‰ä»»åŠ¡IDæ£€ç´¢
python scripts/search_logs.py --task REQ-20251229-001

# æŒ‰çŠ¶æ€æ£€ç´¢
python scripts/search_logs.py --status escalated

# è¾“å‡ºåˆ°æ–‡ä»¶
python scripts/search_logs.py --keyword "ç¼–è¯‘é”™è¯¯" --output result.txt
```

---

## åœæ­¢ä¸æ¢å¤

### ä¼˜é›…åœæ­¢

æŒ‰ `Ctrl+C` ä¸€æ¬¡ï¼Œç³»ç»Ÿä¼šï¼š
1. å®Œæˆå½“å‰éœ€æ±‚çš„å¤„ç†
2. ä¿å­˜æ£€æŸ¥ç‚¹åˆ° `state.json`
3. ç”Ÿæˆæœ¬æ¬¡è¿è¡ŒæŠ¥å‘Š

### å¼ºåˆ¶åœæ­¢

æŒ‰ `Ctrl+C` ä¸¤æ¬¡ï¼Œç³»ç»Ÿä¼šï¼š
1. ç«‹å³åœæ­¢
2. å½“å‰éœ€æ±‚å¯èƒ½ä¸¢å¤±è¿›åº¦
3. ä¸‹æ¬¡éœ€ä½¿ç”¨ `--resume` æ¢å¤

### æ¢å¤è¿è¡Œ

```bash
python main.py --resume
```

ç³»ç»Ÿä¼šè¯»å– `state.json`ï¼Œä»ä¸Šæ¬¡ä¸­æ–­å¤„ç»§ç»­ã€‚

---

## è¿è¡ŒæŠ¥å‘Š

æ¯æ¬¡è¿è¡Œç»“æŸè‡ªåŠ¨ç”Ÿæˆï¼š

```markdown
# è¿è¡ŒæŠ¥å‘Š: 2025-12-29 14:30:22

## æ¦‚è§ˆ

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| è¿è¡Œæ—¶é•¿ | 2å°æ—¶15åˆ† |
| å®Œæˆéœ€æ±‚ | 5 |
| æˆåŠŸç‡ | 80% (4/5) |
| å‡çº§æ•° | 1 |

## éœ€æ±‚è¯¦æƒ…

| ä»»åŠ¡ID | çŠ¶æ€ | ç¼–è¯‘å°è¯• | è¯„å®¡åˆ†æ•° | è€—æ—¶ |
|--------|------|----------|----------|------|
| REQ-001 | âœ… å®Œæˆ | 1 | 8.2 | 15min |
| REQ-002 | âœ… å®Œæˆ | 2 | 7.5 | 22min |
| REQ-003 | âš ï¸ å‡çº§ | 3 | 4.8 | 45min |
| REQ-004 | âœ… å®Œæˆ | 1 | 8.8 | 12min |
| REQ-005 | âœ… å®Œæˆ | 1 | 9.1 | 10min |

## é«˜é¢‘é—®é¢˜ Top 5

1. **RC-FRM-001** (3æ¬¡) - äº‹ä»¶ä¼ æ’­æ–¹å‘æ··æ·†
2. **RC-CMP-003** (2æ¬¡) - ç±»å‹ä¸åŒ¹é…
3. ...

## æ‰‹å†Œæ›´æ–°æ‘˜è¦

- æ–°å¢æ ¹æº: 2
- å½’å¹¶æ¬¡æ•°: 8
- æ›´æ–°æ–‡ä»¶: 3

## å‡çº§ä»»åŠ¡

- REQ-003: è§ logs/escalation/REQ-20251229-003/summary.md
```

---

## æ•…éšœæ’æŸ¥

### ç¼–è¯‘è¿æ¥å¤±è´¥

```
ğŸ”´ é”™è¯¯: è¿æ¥ UEFN Workflow Server å¤±è´¥
```

**è§£å†³**: ç¡®ä¿ UEFN å·²å¯åŠ¨å¹¶åŠ è½½é¡¹ç›®

### Agent è°ƒç”¨è¶…æ—¶

```
ğŸ”´ é”™è¯¯: Agent è°ƒç”¨è¶…æ—¶ (300s)
```

**è§£å†³**: 
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å¢åŠ  `agent.timeout` é…ç½®
3. ç®€åŒ–éœ€æ±‚æè¿°

### Git å†²çª

```
ğŸ”´ é”™è¯¯: Git åˆå¹¶å†²çª
```

**è§£å†³**: 
1. æ‰‹åŠ¨è§£å†³å†²çª
2. è¿è¡Œ `python main.py --resume`

---

## ä¾èµ–Skill

| Skill | ç”¨é€” |
|-------|------|
| verseCli | ç¼–è¯‘éªŒè¯ |
| verseTactician | æˆ˜æœ¯æ‰‹å†Œç»´æŠ¤ |
| verseRequirementProposer | éœ€æ±‚ç”Ÿæˆï¼ˆå¯é€‰ï¼‰ |
| verseCodeAuditor | è¯„å®¡å‚è€ƒ |

---

## ç›¸å…³æ–‡ä»¶

- [shared/tactical-schema.md](../shared/tactical-schema.md) - ç»“æ„åŒ–Schema
- [verseTactician/SKILL.md](../verseTactician/SKILL.md) - æˆ˜æœ¯æ‰‹å†ŒAgent
- [verseCli/SKILL.md](../verseCli/SKILL.md) - ç¼–è¯‘å·¥å…·
- [quick-start.md](../quick-start.md) - å¿«é€Ÿå¯åŠ¨æŒ‡å—
