# GitHub Agentic Workflows è§¦å‘å™¨å®Œæ•´æŒ‡å—

> **ç›®çš„**: æœ¬æ–‡æ¡£æä¾›å®Œæ•´çš„å·¥ä½œæµè§¦å‘å™¨ï¼ˆ`on:` å­—æ®µï¼‰è§„åˆ™ï¼Œå¸®åŠ© Agent å¿«é€Ÿç†è§£å¦‚ä½•ç¼–å†™å¤æ‚çš„è§¦å‘å™¨é…ç½®ã€‚

## ç›®å½•

- [è§¦å‘å™¨åŸºç¡€](#è§¦å‘å™¨åŸºç¡€)
- [æ ‡å‡† GitHub äº‹ä»¶è§¦å‘å™¨](#æ ‡å‡†-github-äº‹ä»¶è§¦å‘å™¨)
- [Slash Command è§¦å‘å™¨](#slash-command-è§¦å‘å™¨)
- [æ ‡ç­¾è§¦å‘å™¨ç®€å†™è¯­æ³•](#æ ‡ç­¾è§¦å‘å™¨ç®€å†™è¯­æ³•)
- [è§¦å‘å™¨é«˜çº§é…ç½®](#è§¦å‘å™¨é«˜çº§é…ç½®)
- [å¤åˆè§¦å‘å™¨æ¨¡å¼](#å¤åˆè§¦å‘å™¨æ¨¡å¼)
- [æ¡ä»¶æ‰§è¡Œä¸è¿‡æ»¤](#æ¡ä»¶æ‰§è¡Œä¸è¿‡æ»¤)
- [æœ€ä½³å®è·µä¸å¸¸è§æ¨¡å¼](#æœ€ä½³å®è·µä¸å¸¸è§æ¨¡å¼)

---

## è§¦å‘å™¨åŸºç¡€

### åŸºæœ¬æ ¼å¼

è§¦å‘å™¨é€šè¿‡ `on:` å­—æ®µé…ç½®ï¼Œæ”¯æŒä¸‰ç§æ ¼å¼ï¼š

```yaml
# 1. ç®€å•å­—ç¬¦ä¸²æ ¼å¼
on: push

# 2. æ•°ç»„æ ¼å¼ï¼ˆå¤šä¸ªäº‹ä»¶ï¼‰
on: [push, pull_request]

# 3. å¯¹è±¡æ ¼å¼ï¼ˆå¤æ‚é…ç½®ï¼‰
on:
  issues:
    types: [opened, edited]
  pull_request:
    types: [opened]
```

### è§¦å‘å™¨æ˜¯å¿…éœ€å­—æ®µ

æ¯ä¸ªå·¥ä½œæµ**å¿…é¡»**åŒ…å« `on:` å­—æ®µï¼Œå¦åˆ™ç¼–è¯‘ä¼šå¤±è´¥ã€‚

---

## æ ‡å‡† GitHub äº‹ä»¶è§¦å‘å™¨

### Issues äº‹ä»¶

```yaml
on:
  issues:
    types: [opened, edited, closed, deleted, transferred, 
            pinned, unpinned, labeled, unlabeled, 
            locked, unlocked, milestoned, demilestoned,
            assigned, unassigned, reopened]
```

**å¸¸ç”¨ç»„åˆ:**

```yaml
# Issue åˆ›å»ºæ—¶
on:
  issues:
    types: [opened]

# Issue çŠ¶æ€å˜åŒ–
on:
  issues:
    types: [opened, edited, reopened, closed]
```

### Pull Request äº‹ä»¶

```yaml
on:
  pull_request:
    types: [opened, edited, closed, reopened, synchronize,
            converted_to_draft, ready_for_review,
            labeled, unlabeled, assigned, unassigned,
            review_requested, review_request_removed,
            auto_merge_enabled, auto_merge_disabled]
    branches: [main, develop]    # ç›®æ ‡åˆ†æ”¯è¿‡æ»¤
    paths:                        # è·¯å¾„è¿‡æ»¤
      - 'src/**'
      - '*.md'
    forks: ["*"]                  # Fork å®‰å…¨é…ç½®
```

#### Fork å®‰å…¨é…ç½® âš ï¸

**é»˜è®¤è¡Œä¸º**: `pull_request` è§¦å‘å™¨**é˜»æ­¢æ‰€æœ‰ fork**ï¼Œä»…å…è®¸åŒä»“åº“ PRã€‚

```yaml
# é»˜è®¤: ä»…åŒä»“åº“ PRï¼ˆå®‰å…¨ï¼‰
on:
  pull_request:
    types: [opened]

# å…è®¸æ‰€æœ‰ forkï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
on:
  pull_request:
    types: [opened]
    forks: ["*"]

# ä»…å…è®¸å¯ä¿¡ fork
on:
  pull_request:
    types: [opened]
    forks:
      - "trusted-org/*"           # ç»„ç»‡ä¸‹æ‰€æœ‰ä»“åº“
      - "trusted-user/repo"       # ç‰¹å®šç”¨æˆ·çš„ç‰¹å®šä»“åº“
```

### Push äº‹ä»¶

```yaml
on:
  push:
    branches:
      - main
      - 'release/**'              # é€šé…ç¬¦åŒ¹é…
    branches-ignore:
      - 'feature/**'
    tags:
      - 'v*'
    tags-ignore:
      - 'v*-beta'
    paths:
      - 'src/**'
      - '!src/test/**'            # æ’é™¤è·¯å¾„
```

### Issue Comment äº‹ä»¶

```yaml
on:
  issue_comment:
    types: [created, edited, deleted]
```

**æ³¨æ„**: `issue_comment` äº‹ä»¶åŒæ—¶æ•è· Issue è¯„è®ºå’Œ PR è¯„è®ºã€‚ä½¿ç”¨æ¡ä»¶è¿‡æ»¤ï¼š

```yaml
# ä»… Issue è¯„è®º
if: ${{ !github.event.issue.pull_request }}

# ä»… PR è¯„è®º
if: ${{ github.event.issue.pull_request }}
```

### Pull Request Review äº‹ä»¶

```yaml
on:
  pull_request_review:
    types: [submitted, edited, dismissed]

on:
  pull_request_review_comment:
    types: [created, edited, deleted]
```

### Discussion äº‹ä»¶

```yaml
on:
  discussion:
    types: [created, edited, deleted, answered, unanswered,
            labeled, unlabeled, locked, unlocked,
            category_changed, pinned, unpinned, transferred]

on:
  discussion_comment:
    types: [created, edited, deleted]
```

### Schedule äº‹ä»¶ï¼ˆå®šæ—¶è§¦å‘ï¼‰

```yaml
on:
  schedule:
    - cron: "0 9 * * 1"           # æ¯å‘¨ä¸€ 9:00 UTC
    - cron: "0 0 * * *"           # æ¯å¤©åˆå¤œ
    - cron: "*/15 * * * *"        # æ¯ 15 åˆ†é’Ÿ
```

**Cron è¯­æ³•:**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59)
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23)
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥ (1 - 31)
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆ (1 - 12)
â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ˜ŸæœŸ (0 - 6, 0=å‘¨æ—¥)
â”‚ â”‚ â”‚ â”‚ â”‚
* * * * *
```

**æ¨¡ç³Šè°ƒåº¦ï¼ˆæ¨èï¼‰:**

```yaml
# è‡ªåŠ¨åˆ†æ•£æ‰§è¡Œæ—¶é—´ï¼Œé¿å…è´Ÿè½½å³°å€¼
on:
  schedule: daily     # æ¯æ—¥ï¼ˆæ—¶é—´è‡ªåŠ¨åˆ†æ•£ï¼‰
  schedule: weekly    # æ¯å‘¨ï¼ˆæ—¶é—´è‡ªåŠ¨åˆ†æ•£ï¼‰
```

### Workflow Dispatchï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰

```yaml
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'éƒ¨ç½²ç¯å¢ƒ'
        required: true
        type: choice
        options:
          - staging
          - production
      debug:
        description: 'å¯ç”¨è°ƒè¯•æ¨¡å¼'
        required: false
        type: boolean
        default: false
      version:
        description: 'ç‰ˆæœ¬å·'
        required: true
        type: string
```

**è¾“å…¥ç±»å‹:**

- `string` - æ–‡æœ¬è¾“å…¥
- `choice` - ä¸‹æ‹‰é€‰æ‹©ï¼ˆéœ€é…åˆ `options`ï¼‰
- `boolean` - å¸ƒå°”å¼€å…³
- `number` - æ•°å­—è¾“å…¥
- `environment` - ç¯å¢ƒé€‰æ‹©å™¨

**è®¿é—®è¾“å…¥å€¼:**

```markdown
éƒ¨ç½²ç¯å¢ƒ: ${{ github.event.inputs.environment }}
```

### Workflow Run äº‹ä»¶

ç›‘æ§å…¶ä»–å·¥ä½œæµçš„è¿è¡ŒçŠ¶æ€ï¼š

```yaml
on:
  workflow_run:
    workflows: ["CI Build", "Deploy"]   # ç›‘æ§çš„å·¥ä½œæµåç§°
    types:
      - completed
      - requested
    branches:
      - main
```

**ç»“åˆæ¡ä»¶è¿‡æ»¤:**

```yaml
if: ${{ github.event.workflow_run.conclusion == 'failure' }}
```

### Workflow Callï¼ˆå¯å¤ç”¨å·¥ä½œæµï¼‰

è¢«å…¶ä»–å·¥ä½œæµè°ƒç”¨ï¼š

```yaml
on:
  workflow_call:
    inputs:
      workflow_name:
        description: 'è°ƒç”¨å·¥ä½œæµçš„åç§°'
        required: true
        type: string
      run_id:
        description: 'å·¥ä½œæµè¿è¡Œ ID'
        required: true
        type: string
    secrets:
      TOKEN:
        required: true
```

### å…¶ä»–å¸¸ç”¨äº‹ä»¶

```yaml
# Release äº‹ä»¶
on:
  release:
    types: [published, created, edited, deleted, prereleased, released]

# Label äº‹ä»¶
on:
  label:
    types: [created, edited, deleted]

# Milestone äº‹ä»¶
on:
  milestone:
    types: [created, opened, closed, edited, deleted]

# Project äº‹ä»¶
on:
  project:
    types: [created, updated, closed, reopened, deleted]

# Check Run äº‹ä»¶
on:
  check_run:
    types: [created, rerequested, completed, requested_action]

# Check Suite äº‹ä»¶
on:
  check_suite:
    types: [completed, requested, rerequested]

# Deployment äº‹ä»¶
on:
  deployment:
  deployment_status:

# Registry Package äº‹ä»¶
on:
  registry_package:
    types: [published, updated]
```

---

## Slash Command è§¦å‘å™¨

### åŸºç¡€è¯­æ³•

å“åº” Issue/PR è¯„è®ºä¸­çš„ `/command` æåŠï¼š

```yaml
on:
  slash_command:
    name: my-bot
```

è¿™ä¼šè‡ªåŠ¨å“åº”ï¼š

- Issue æ­£æ–‡ä¸­çš„ `/my-bot`
- Issue è¯„è®ºä¸­çš„ `/my-bot`
- PR æ­£æ–‡å’Œè¯„è®ºä¸­çš„ `/my-bot`

### é™åˆ¶è§¦å‘ä½ç½®

ä½¿ç”¨ `events:` å­—æ®µé™åˆ¶å‘½ä»¤å“åº”ä½ç½®ï¼š

```yaml
on:
  slash_command:
    name: review
    events: [pull_request_comment, pull_request_review_comment]
```

**æ”¯æŒçš„äº‹ä»¶æ ‡è¯†ç¬¦:**

| æ ‡è¯†ç¬¦ | è¯´æ˜ |
|--------|------|
| `issues` | Issue æ­£æ–‡ï¼ˆopened, edited, reopenedï¼‰ |
| `issue_comment` | ä»… Issue è¯„è®ºï¼ˆä¸åŒ…æ‹¬ PR è¯„è®ºï¼‰ |
| `pull_request_comment` | ä»… PR è¯„è®ºï¼ˆä¸åŒ…æ‹¬ Issue è¯„è®ºï¼‰ |
| `pull_request` | PR æ­£æ–‡ï¼ˆopened, edited, reopenedï¼‰ |
| `pull_request_review_comment` | PR å®¡é˜…è¯„è®º |
| `*` | æ‰€æœ‰è¯„è®ºç›¸å…³äº‹ä»¶ï¼ˆé»˜è®¤ï¼‰ |

### ç¤ºä¾‹

```yaml
# /plan å‘½ä»¤ - ä»…å“åº” Issue å’Œ Discussion è¯„è®º
on:
  slash_command:
    name: plan
    events: [issue_comment, discussion_comment]

# /grumpy å‘½ä»¤ - ä»…å“åº” PR ç›¸å…³è¯„è®º
on:
  slash_command:
    name: grumpy
    events: [pull_request_comment, pull_request_review_comment]

# /scout å‘½ä»¤ - å“åº”æ‰€æœ‰ä½ç½®ï¼ˆé»˜è®¤ï¼‰
on:
  slash_command:
    name: scout
```

**âš ï¸ æ³¨æ„**: `command:` è§¦å‘å™¨å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ `slash_command:`ã€‚

### @mention å’Œè‡ªå®šä¹‰å­—ç¬¦ä¸²è§¦å‘

é™¤äº†ä½¿ç”¨ `/command` æ ¼å¼ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ç›‘å¬ Issue/PR è¯„è®ºäº‹ä»¶ï¼Œç»“åˆæ¡ä»¶è¿‡æ»¤å®ç° @mention æˆ–ä»»æ„å­—ç¬¦ä¸²è§¦å‘ã€‚

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ slash_commandï¼ˆæ¨èï¼‰

`slash_command` ä¼šè‡ªåŠ¨åŒ¹é… `/name` æ ¼å¼çš„å‘½ä»¤ï¼š

```yaml
on:
  slash_command:
    name: copilot  # å“åº” /copilot
```

**ç”¨æˆ·è§¦å‘æ–¹å¼ï¼š**

- åœ¨ Issue ä¸­è¯„è®º `/copilot å¸®æˆ‘åˆ†æè¿™ä¸ªé—®é¢˜`
- åœ¨ PR ä¸­è¯„è®º `/copilot è¯·å®¡æŸ¥ä»£ç `

#### æ–¹å¼äºŒï¼šç›‘å¬ issue_comment + if æ¡ä»¶è¿‡æ»¤

å¯¹äºé `/` å¼€å¤´çš„è§¦å‘è¯ï¼ˆå¦‚ `@bot`ã€`help me` ç­‰ï¼‰ï¼Œä½¿ç”¨ `issue_comment` äº‹ä»¶é…åˆ `if` æ¡ä»¶ï¼š

```yaml
on:
  issue_comment:
    types: [created]

# å½“è¯„è®ºä¸­åŒ…å« @my-bot æ—¶è§¦å‘
if: ${{ contains(github.event.comment.body, '@my-bot') }}
```

**æ›´å¤šæ¡ä»¶è¿‡æ»¤ç¤ºä¾‹ï¼š**

```yaml
# @mention ç‰¹å®šç”¨æˆ·åè§¦å‘
if: ${{ contains(github.event.comment.body, '@copilot-bot') }}

# åŒ…å«ç‰¹å®šå…³é”®è¯è§¦å‘
if: ${{ contains(github.event.comment.body, 'help me') }}

# ä»¥ç‰¹å®šå‰ç¼€å¼€å¤´è§¦å‘
if: ${{ startsWith(github.event.comment.body, '!ask') }}

# å¤šæ¡ä»¶ç»„åˆï¼šåŒ…å«å…³é”®è¯ä¸”é bot å‘å‡º
if: ${{ contains(github.event.comment.body, '@assistant') && !contains(github.actor, '[bot]') }}

# åŒ¹é…å¤šä¸ªè§¦å‘è¯ä¹‹ä¸€
if: ${{ contains(github.event.comment.body, '@helper') || contains(github.event.comment.body, '/help') }}
```

#### æ–¹å¼ä¸‰ï¼šIssue æ­£æ–‡è§¦å‘

ç›‘å¬ Issue åˆ›å»º/ç¼–è¾‘äº‹ä»¶ï¼Œæ ¹æ®æ­£æ–‡å†…å®¹è§¦å‘ï¼š

```yaml
on:
  issues:
    types: [opened, edited]

# Issue æ­£æ–‡åŒ…å«ç‰¹å®šæ ‡è®°æ—¶è§¦å‘
if: ${{ contains(github.event.issue.body, '[auto-analyze]') }}
```

#### å®Œæ•´ç¤ºä¾‹ï¼š@mention å“åº” Bot

```yaml
---
name: Mention Response Bot
description: å“åº” Issue è¯„è®ºä¸­çš„ @my-assistant æåŠ
on:
  issue_comment:
    types: [created]
if: ${{ contains(github.event.comment.body, '@my-assistant') && !contains(github.actor, '[bot]') }}
permissions:
  contents: read
  issues: read
safe-outputs:
  add-comment:
    max: 1
  reaction: "eyes"
timeout-minutes: 10
---

# @my-assistant å“åº” Bot

å½“ç”¨æˆ·åœ¨è¯„è®ºä¸­ @my-assistant æ—¶ï¼Œåˆ†æè¯„è®ºå†…å®¹å¹¶æä¾›å¸®åŠ©ã€‚

## è§¦å‘ä¸Šä¸‹æ–‡

- **è¯„è®ºå†…å®¹**: ${{ needs.activation.outputs.text }}
- **Issue ç¼–å·**: ${{ github.event.issue.number }}
- **è¯„è®ºè€…**: ${{ github.actor }}

## ä»»åŠ¡

1. è§£æç”¨æˆ·è¯·æ±‚
2. æä¾›æœ‰å¸®åŠ©çš„å›å¤
3. å¦‚æœæ— æ³•å¤„ç†ï¼Œå‹å¥½å‘ŠçŸ¥ç”¨æˆ·
```

#### è§¦å‘è¯è®¾è®¡æœ€ä½³å®è·µ

| è§¦å‘æ–¹å¼ | æ ¼å¼ | é€‚ç”¨åœºæ™¯ |
|----------|------|----------|
| `/command` | `/analyze`, `/help` | æ˜ç¡®çš„å‘½ä»¤æ“ä½œ |
| `@botname` | `@copilot`, `@assistant` | å¯¹è¯å¼äº¤äº’ |
| `!prefix` | `!ask`, `!search` | ç±» Discord é£æ ¼ |
| `[marker]` | `[auto-fix]`, `[needs-review]` | Issue æ­£æ–‡æ ‡è®° |

#### å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **é˜²æ­¢æ— é™å¾ªç¯**ï¼šç¡®ä¿æ’é™¤ bot è‡ªå·±çš„è¯„è®º

```yaml
# å¿…é¡»æ·»åŠ æ­¤è¿‡æ»¤ï¼Œé˜²æ­¢ bot å›å¤è‡ªå·±
if: ${{ contains(github.event.comment.body, '@my-bot') && github.actor != 'github-actions[bot]' }}
```

âš ï¸ **@mention ä¸­å’Œ**ï¼šAgent è¾“å‡ºä¸­çš„ `@user` ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºä»£ç æ ¼å¼ `` `@user` ``ï¼Œé˜²æ­¢æ„å¤–é€šçŸ¥ç”¨æˆ·ã€‚å¦‚éœ€çœŸæ­£ @mentionï¼Œä½¿ç”¨ `safe-outputs` ä¸­çš„ä¸“ç”¨åŠŸèƒ½ã€‚

---

## æ ‡ç­¾è§¦å‘å™¨ç®€å†™è¯­æ³•

### Issue æ ‡ç­¾è§¦å‘

```yaml
# æ ‡å‡†å†™æ³•
on: issue labeled bug enhancement priority-high

# é€—å·åˆ†éš”å†™æ³•
on: issue labeled bug, enhancement, priority-high
```

**è‡ªåŠ¨å±•å¼€ä¸º:**

- Issue è¢«æ·»åŠ æŒ‡å®šæ ‡ç­¾æ—¶è§¦å‘
- è‡ªåŠ¨åŒ…å« `workflow_dispatch` è§¦å‘å™¨

### Pull Request æ ‡ç­¾è§¦å‘

```yaml
on: pull_request labeled needs-review approved ready-to-merge
```

### Discussion æ ‡ç­¾è§¦å‘

```yaml
on: discussion labeled question announcement help-wanted
```

**âš ï¸ æ³¨æ„**: Discussion äº‹ä»¶ä¸æ”¯æŒ GitHub Actions çš„ `names` å­—æ®µè¿‡æ»¤ï¼Œæ ‡ç­¾è¿‡æ»¤éœ€é€šè¿‡ä½œä¸šæ¡ä»¶å¤„ç†ã€‚

---

## è§¦å‘å™¨é«˜çº§é…ç½®

### stop-after æ‰§è¡Œæˆªæ­¢æ—¶é—´

è®¾ç½®å·¥ä½œæµçš„è‡ªåŠ¨åœæ­¢æ—¶é—´ï¼š

```yaml
on:
  schedule:
    - cron: "0 9 * * 1"
  stop-after: +1mo              # 1 ä¸ªæœˆååœæ­¢è°ƒåº¦
```

**æ”¯æŒçš„æ ¼å¼:**

| æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| ç»å¯¹æ—¶é—´æˆ³ | `"2025-06-01 00:00:00"` | ç²¾ç¡®åˆ°ç§’ |
| ç›¸å¯¹æ—¶é—´ | `+25h` | 25 å°æ—¶å |
| ç›¸å¯¹æ—¶é—´ | `+3d` | 3 å¤©å |
| ç›¸å¯¹æ—¶é—´ | `+1mo` | 1 ä¸ªæœˆå |
| ç»„åˆæ—¶é—´ | `+1d12h` | 1 å¤© 12 å°æ—¶å |

**æ³¨æ„**: ç›¸å¯¹æ—¶é—´æœ€å°å•ä½æ˜¯å°æ—¶(h)ã€‚

### reaction è¡¨æƒ…ç¬¦å·ååº”

è§¦å‘æ—¶è‡ªåŠ¨ä¸ºè§¦å‘é¡¹æ·»åŠ è¡¨æƒ…ï¼š

```yaml
on:
  issues:
    types: [opened]
  reaction: "eyes"              # ğŸ‘€
```

å¸¸ç”¨è¡¨æƒ…ç¬¦å·ï¼š

- `eyes` - ğŸ‘€ è¡¨ç¤ºæ­£åœ¨æŸ¥çœ‹
- `+1` - ğŸ‘ è¡¨ç¤ºç¡®è®¤
- `rocket` - ğŸš€ è¡¨ç¤ºè¿›è¡Œä¸­
- `heart` - â¤ï¸ è¡¨ç¤ºå–œæ¬¢

### manual-approval æ‰‹åŠ¨å®¡æ‰¹

è¦æ±‚æ‰‹åŠ¨å®¡æ‰¹åæ‰æ‰§è¡Œï¼š

```yaml
on:
  workflow_dispatch:
  manual-approval: true
```

è¿™ä¼šä½¿ç”¨ GitHub Environment Protection Rules å®ç°å®¡æ‰¹æµç¨‹ã€‚

---

## å¤åˆè§¦å‘å™¨æ¨¡å¼

### å¤šäº‹ä»¶è§¦å‘

```yaml
on:
  issues:
    types: [opened, edited]
  pull_request:
    types: [opened, synchronize]
  workflow_dispatch:
```

### åŠä¸»åŠ¨ Agent æ¨¡å¼

ç»“åˆå®šæ—¶å’Œäº‹ä»¶è§¦å‘ï¼Œå®ç°ä¸»åŠ¨ç›‘æ§ + è¢«åŠ¨å“åº”ï¼š

```yaml
on:
  schedule:
    - cron: "0/10 * * * *"      # æ¯ 10 åˆ†é’Ÿæ£€æŸ¥
  issues:
    types: [opened, edited, closed]
  issue_comment:
    types: [created, edited]
  pull_request:
    types: [opened, edited, closed]
  push:
    branches: [main]
  workflow_dispatch:
```

### CI å¤±è´¥ç›‘æ§æ¨¡å¼

ç›‘æ§ç‰¹å®šå·¥ä½œæµçš„å¤±è´¥ï¼š

```yaml
on:
  workflow_run:
    workflows: ["CI Build", "Tests"]
    types:
      - completed
    branches:
      - main
  stop-after: +1mo

if: ${{ github.event.workflow_run.conclusion == 'failure' }}
```

### æ¯æ—¥æŠ¥å‘Šæ¨¡å¼

```yaml
on:
  schedule:
    - cron: "0 9 * * 1-5"       # å·¥ä½œæ—¥ 9:00
  stop-after: +1mo
  workflow_dispatch: null
```

---

## æ¡ä»¶æ‰§è¡Œä¸è¿‡æ»¤

### ä½¿ç”¨ if æ¡ä»¶

```yaml
on:
  issues:
    types: [opened]

# ä»…å¤„ç†é bot åˆ›å»ºçš„ Issue
if: ${{ github.actor != 'dependabot[bot]' }}
```

### å¸¸ç”¨æ¡ä»¶è¡¨è¾¾å¼

```yaml
# ä»…ä¸»åˆ†æ”¯
if: ${{ github.ref == 'refs/heads/main' }}

# æ’é™¤ bot
if: ${{ !contains(github.actor, '[bot]') }}

# ç‰¹å®šæ ‡ç­¾
if: ${{ contains(github.event.issue.labels.*.name, 'bug') }}

# å·¥ä½œæµå¤±è´¥æ—¶
if: ${{ github.event.workflow_run.conclusion == 'failure' }}

# PR æ¥è‡ª fork
if: ${{ github.event.pull_request.head.repo.fork == true }}

# åŒ…å«ç‰¹å®šæ–‡ä»¶å˜æ›´
if: ${{ contains(github.event.commits.*.modified, 'package.json') }}
```

---

## æœ€ä½³å®è·µä¸å¸¸è§æ¨¡å¼

### 1. å§‹ç»ˆåŒ…å« workflow_dispatch

å…è®¸æ‰‹åŠ¨è§¦å‘ä¾¿äºæµ‹è¯•å’Œè°ƒè¯•ï¼š

```yaml
on:
  issues:
    types: [opened]
  workflow_dispatch:              # å§‹ç»ˆæ·»åŠ 
```

### 2. ä½¿ç”¨æ¨¡ç³Šè°ƒåº¦é¿å…è´Ÿè½½å³°å€¼

```yaml
# âŒ ä¸æ¨èï¼šå›ºå®šæ—¶é—´
on:
  schedule:
    - cron: "0 0 * * *"           # æ‰€æœ‰å·¥ä½œæµåŒæ—¶æ‰§è¡Œ

# âœ… æ¨èï¼šæ¨¡ç³Šè°ƒåº¦
on:
  schedule: daily                  # è‡ªåŠ¨åˆ†æ•£æ‰§è¡Œæ—¶é—´
```

### 3. æ·»åŠ  stop-after æ§åˆ¶æˆæœ¬

```yaml
on:
  schedule:
    - cron: "0 9 * * 1"
  stop-after: +1mo                 # 1 ä¸ªæœˆåè‡ªåŠ¨åœæ­¢
```

### 4. Fork å®‰å…¨é»˜è®¤

```yaml
# é»˜è®¤é˜»æ­¢ forkï¼Œä»…åœ¨å¿…è¦æ—¶æ˜¾å¼å…è®¸
on:
  pull_request:
    types: [opened]
    forks: ["trusted-org/*"]      # ä»…å…è®¸å¯ä¿¡æ¥æº
```

### 5. äº‹ä»¶ç±»å‹ç²¾ç¡®åŒ¹é…

```yaml
# âŒ ä¸æ¨èï¼šæ•è·æ‰€æœ‰ç±»å‹
on:
  issues:

# âœ… æ¨èï¼šæ˜ç¡®æŒ‡å®šç±»å‹
on:
  issues:
    types: [opened, reopened]
```

### 6. è·¯å¾„è¿‡æ»¤å‡å°‘ä¸å¿…è¦è§¦å‘

```yaml
on:
  push:
    branches: [main]
    paths:
      - 'src/**'                   # ä»…ä»£ç å˜æ›´è§¦å‘
      - '!src/test/**'             # æ’é™¤æµ‹è¯•æ–‡ä»¶
```

---

## å®Œæ•´ç¤ºä¾‹å‚è€ƒ

### Issue åˆ†ç±» Bot

```yaml
---
on:
  issues:
    types: [opened]
  reaction: "eyes"
permissions:
  contents: read
  issues: read
safe-outputs:
  add-labels:
    allowed: [bug, feature, documentation]
timeout-minutes: 5
---
```

### æ¯æ—¥å›¢é˜ŸçŠ¶æ€æŠ¥å‘Š

```yaml
---
on:
  schedule:
    - cron: "0 9 * * 1-5"
  stop-after: +1mo
  workflow_dispatch: null
permissions:
  contents: read
  issues: read
  pull-requests: read
safe-outputs:
  create-issue:
    expires: 1d
    title-prefix: "[team-status] "
timeout-minutes: 10
---
```

### æ·±åº¦ç ”ç©¶ Bot

```yaml
---
on:
  slash_command:
    name: scout
  workflow_dispatch:
    inputs:
      topic:
        description: 'ç ”ç©¶ä¸»é¢˜'
        required: true
permissions:
  contents: read
  issues: read
tools:
  web-search:
  web-fetch:
safe-outputs:
  add-comment:
    max: 1
timeout-minutes: 10
---
```

### CI å¤±è´¥è¯Šæ–­

```yaml
---
on:
  workflow_run:
    workflows: ["CI Build"]
    types: [completed]
    branches: [main]
  stop-after: +1mo
if: ${{ github.event.workflow_run.conclusion == 'failure' }}
permissions:
  actions: read
  contents: read
safe-outputs:
  create-issue:
    title-prefix: "[CI Failure] "
timeout-minutes: 10
---
```

### ä»£ç å®¡æŸ¥ Bot

```yaml
---
on:
  slash_command:
    name: review
    events: [pull_request_comment, pull_request_review_comment]
permissions:
  contents: read
  pull-requests: read
safe-outputs:
  add-comment:
    max: 1
  create-pull-request-review-comment:
    max: 5
timeout-minutes: 10
---
```

### å¤š Sub-Issue åä½œå¼€å‘æ¨¡å¼ï¼ˆé«˜çº§æ¡ˆä¾‹ï¼‰

è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„å¤šå·¥ä½œæµç¼–æ’åœºæ™¯ï¼š

1. ä¸» Issue è¢«æ ‡è®°ä¸º `ready-to-plan` æ—¶ï¼Œåˆ›å»º PR å’Œå¤šä¸ª Sub-Issue
2. æ¯ä¸ª Sub-Issue å®Œæˆæ—¶ï¼Œè‡ªåŠ¨å°†ä»£ç æäº¤åˆ°åŒä¸€ä¸ª PRï¼ˆæ— éœ€å®¡æ‰¹ï¼‰
3. æ‰€æœ‰ Sub-Issue éƒ½å®Œæˆåï¼Œé€šçŸ¥ç”¨æˆ·å®¡æŸ¥ PR

**éœ€è¦ 3 ä¸ªå·¥ä½œæµé…åˆï¼š**

#### å·¥ä½œæµ 1ï¼šä¸» Issue è§„åˆ’å™¨ï¼ˆåˆ›å»º PR å’Œ Sub-Issuesï¼‰

```yaml
---
name: Task Planner
description: å½“ä¸» Issue è¢«æ ‡è®°ä¸º ready-to-plan æ—¶ï¼Œåˆ›å»º PR åˆ†æ”¯å’Œ Sub-Issues
on: issue labeled ready-to-plan
permissions:
  contents: read
  issues: read
tools:
  github:
    toolsets: [issues, repos]
  repo-memory:
    branch-name: memory/task-coordination
    file-glob: "tasks/**"
safe-outputs:
  create-issue:
    title-prefix: "[task] "
    labels: [sub-task, auto-commit]
    max: 6
  create-pull-request:
    title-prefix: "[wip] "
    labels: [auto-generated, needs-review]
    draft: true
  link-sub-issue:
    max: 5
timeout-minutes: 15
---

# ä»»åŠ¡è§„åˆ’å™¨

åˆ†æä¸» Issue #${{ github.event.issue.number }} å¹¶åˆ›å»ºå¼€å‘è®¡åˆ’ã€‚

## æ­¥éª¤

### 1. åˆ›å»ºåè°ƒæ–‡ä»¶

åœ¨ repo-memory ä¸­åˆ›å»º `tasks/issue-${{ github.event.issue.number }}.json`ï¼š

```json
{
  "parent_issue": ${{ github.event.issue.number }},
  "pr_branch": "feature/issue-${{ github.event.issue.number }}",
  "status": "planning",
  "sub_issues": [],
  "completed_count": 0,
  "total_count": 0,
  "created_at": "[timestamp]",
  "assignee": "${{ github.actor }}"
}
```

### 2. åˆ›å»ºå·¥ä½œåˆ†æ”¯å’Œ Draft PR

ä½¿ç”¨ `create-pull-request` åˆ›å»º Draft PRï¼š

- åˆ†æ”¯å: `feature/issue-${{ github.event.issue.number }}`
- æ ‡é¢˜: `[WIP] Issue #${{ github.event.issue.number }}: [ä¸» Issue æ ‡é¢˜]`
- Body ä¸­åŒ…å«: `tracker:issue-${{ github.event.issue.number }}`

### 3. åˆ†è§£ä»»åŠ¡å¹¶åˆ›å»º Sub-Issues

åˆ›å»º Sub-Issuesï¼ˆæœ€å¤š 5 ä¸ªï¼‰ï¼Œæ¯ä¸ªåŒ…å«ï¼š

- `parent`: è®¾ç½®ä¸º `#${{ github.event.issue.number }}`
- Body ä¸­åŒ…å«: `tracker:issue-${{ github.event.issue.number }}`
- Body ä¸­åŒ…å«: `branch:feature/issue-${{ github.event.issue.number }}`
- æ ‡ç­¾: `sub-task`, `auto-commit`

### 4. æ›´æ–°åè°ƒæ–‡ä»¶

æ›´æ–° `tasks/issue-${{ github.event.issue.number }}.json`ï¼Œè®°å½•æ‰€æœ‰ Sub-Issue ç¼–å·ã€‚

#### å·¥ä½œæµ 2ï¼šSub-Issue æ‰§è¡Œå™¨ï¼ˆè‡ªåŠ¨æäº¤åˆ° PRï¼‰

```yaml
---
name: Sub-Task Executor
description: å½“ Sub-Issue è¢«åˆ†é…æ—¶ï¼Œæ‰§è¡Œä»»åŠ¡å¹¶è‡ªåŠ¨æäº¤åˆ°å¯¹åº” PR
on:
  issues:
    types: [assigned]
if: ${{ contains(github.event.issue.labels.*.name, 'sub-task') && contains(github.event.issue.labels.*.name, 'auto-commit') }}
permissions:
  contents: read
  issues: read
  pull-requests: read
tools:
  github:
    toolsets: [issues, repos, pull_requests]
  repo-memory:
    branch-name: memory/task-coordination
    file-glob: "tasks/**"
  edit:
safe-outputs:
  add-commit:
    target: "*"
    max: 1
  update-issue:
    status:
    target: "*"
  add-comment:
    target: "*"
    max: 2
timeout-minutes: 20
---

# Sub-Task æ‰§è¡Œå™¨

æ‰§è¡Œ Sub-Issue #${{ github.event.issue.number }} çš„ä»»åŠ¡ã€‚

## æ­¥éª¤

### 1. è§£æä»»åŠ¡ä¸Šä¸‹æ–‡

ä» Issue body ä¸­æå–ï¼š
- `tracker:issue-XXX` â†’ è·å–çˆ¶ Issue ç¼–å·
- `branch:feature/issue-XXX` â†’ è·å–ç›®æ ‡åˆ†æ”¯

### 2. è¯»å–åè°ƒæ–‡ä»¶

ä» repo-memory åŠ è½½ `tasks/issue-XXX.json` è·å–ï¼š
- PR åˆ†æ”¯å
- å…¶ä»– Sub-Issues çŠ¶æ€

### 3. æ‰§è¡Œå¼€å‘ä»»åŠ¡

æ ¹æ® Issue æè¿°å®Œæˆå¼€å‘ä»»åŠ¡ï¼š
- åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯
- è¿›è¡Œä»£ç ä¿®æ”¹
- æœ¬åœ°éªŒè¯

### 4. æäº¤åˆ° PRï¼ˆæ— éœ€å®¡æ‰¹ï¼‰

ä½¿ç”¨ `add-commit` ç›´æ¥æäº¤åˆ° PR åˆ†æ”¯ï¼š

```json
{
  "type": "add_commit",
  "branch": "feature/issue-XXX",
  "message": "feat: complete sub-task #${{ github.event.issue.number }}\n\nCloses #${{ github.event.issue.number }}"
}
```

### 5. å…³é—­ Sub-Issue å¹¶æ›´æ–°çŠ¶æ€

ä½¿ç”¨ `update-issue` å…³é—­å½“å‰ Sub-Issueï¼Œå¹¶æ›´æ–°åè°ƒæ–‡ä»¶ä¸­çš„ completed_countã€‚

#### å·¥ä½œæµ 3ï¼šå®Œæˆç›‘æ§å™¨ï¼ˆæ‰€æœ‰ä»»åŠ¡å®Œæˆåé€šçŸ¥ç”¨æˆ·ï¼‰

```yaml
---
name: Task Completion Monitor
description: ç›‘æ§ Sub-Issuesï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶é€šçŸ¥ç”¨æˆ·å®¡æŸ¥ PR
on:
  issues:
    types: [closed]
if: ${{ contains(github.event.issue.labels.*.name, 'sub-task') }}
permissions:
  contents: read
  issues: read
  pull-requests: read
tools:
  github:
    toolsets: [issues, repos, pull_requests]
  repo-memory:
    branch-name: memory/task-coordination
    file-glob: "tasks/**"
safe-outputs:
  update-issue:
    target: "*"
  add-comment:
    target: "*"
    max: 2
  request-reviewers:
    max: 1
timeout-minutes: 10
---

# ä»»åŠ¡å®Œæˆç›‘æ§å™¨

æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ Sub-Issues éƒ½å·²å®Œæˆã€‚

## æ­¥éª¤

### 1. è§£æçˆ¶ Issue

ä»å…³é—­çš„ Sub-Issue body ä¸­æå– `tracker:issue-XXX`ã€‚

### 2. æ£€æŸ¥å®ŒæˆçŠ¶æ€

ä» repo-memory åŠ è½½ `tasks/issue-XXX.json`ï¼Œæ£€æŸ¥ï¼š
- è·å–æ‰€æœ‰ Sub-Issue ç¼–å·
- æŸ¥è¯¢æ¯ä¸ª Sub-Issue çš„çŠ¶æ€
- è®¡ç®—å®Œæˆæ¯”ä¾‹

### 3. å¦‚æœå…¨éƒ¨å®Œæˆ

å½“æ‰€æœ‰ Sub-Issues éƒ½å·²å…³é—­æ—¶ï¼š

#### 3.1 æ›´æ–° PR çŠ¶æ€

å°† Draft PR è½¬ä¸º Ready for Reviewï¼Œæ›´æ–°æ ‡é¢˜ç§»é™¤ `[WIP]`ã€‚

#### 3.2 é€šçŸ¥ç”¨æˆ·

åœ¨ä¸» Issue å’Œ PR ä¸Šæ·»åŠ è¯„è®ºï¼š

```markdown
ğŸ‰ **æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼**

@${{ åè°ƒæ–‡ä»¶ä¸­çš„ assignee }} æ‰€æœ‰ Sub-Issues éƒ½å·²å®Œæˆå¹¶æäº¤åˆ° PRã€‚

**å®Œæˆçš„ä»»åŠ¡ï¼š**
- [x] Sub-Issue #XX - [æ ‡é¢˜]
- [x] Sub-Issue #XX - [æ ‡é¢˜]
...

**PR å·²å°±ç»ªï¼š** [PR é“¾æ¥]

è¯·å®¡æŸ¥ä»£ç å¹¶åˆå¹¶ PRã€‚
```

#### 3.3 è¯·æ±‚å®¡é˜…

ä½¿ç”¨ `request-reviewers` è‡ªåŠ¨è¯·æ±‚ assignee å®¡é˜… PRã€‚

### 4. å¦‚æœæœªå…¨éƒ¨å®Œæˆ

åœ¨çˆ¶ Issue ä¸Šæ·»åŠ è¿›åº¦è¯„è®ºï¼š

```markdown
ğŸ“Š **ä»»åŠ¡è¿›åº¦æ›´æ–°**

Sub-Issue #${{ github.event.issue.number }} å·²å®Œæˆã€‚

**å½“å‰è¿›åº¦ï¼š** X/Y å®Œæˆ
**å¾…å®Œæˆï¼š**

- [ ] Sub-Issue #XX - [æ ‡é¢˜]
- ...

#### å…³é”®é…ç½®è¦ç‚¹

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `repo-memory` | è·¨å·¥ä½œæµå…±äº«çŠ¶æ€çš„å…³é”®ï¼Œå­˜å‚¨åè°ƒä¿¡æ¯ |
| `tracker:issue-XXX` | åœ¨ Issue body ä¸­åµŒå…¥è¿½è¸ªæ ‡è¯†ï¼Œæ–¹ä¾¿å…³è”æŸ¥è¯¢ |
| `link-sub-issue` | å»ºç«‹ Parent-Child å…³ç³» |
| `add-commit` | ç›´æ¥æäº¤åˆ°åˆ†æ”¯ï¼Œè·³è¿‡å®¡æ‰¹æµç¨‹ |
| `draft: true` | åˆå§‹åˆ›å»º Draft PRï¼Œå®Œæˆåè½¬ä¸º Ready |
| æ ‡ç­¾è¿‡æ»¤ | ä½¿ç”¨ `sub-task` + `auto-commit` æ ‡ç­¾è¯†åˆ«è‡ªåŠ¨ä»»åŠ¡ |

#### è§¦å‘æµç¨‹å›¾

```text
ä¸» Issue æ·»åŠ  ready-to-plan æ ‡ç­¾
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å·¥ä½œæµ 1: è§„åˆ’å™¨     â”‚
  â”‚ - åˆ›å»º Draft PR     â”‚
  â”‚ - åˆ›å»º Sub-Issues   â”‚
  â”‚ - å†™å…¥ repo-memory  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ (Sub-Issues è¢« assign)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å·¥ä½œæµ 2: æ‰§è¡Œå™¨     â”‚ â†â”€â”€ å¹¶è¡Œæ‰§è¡Œå¤šä¸ª
  â”‚ - è¯»å–ä»»åŠ¡ä¸Šä¸‹æ–‡     â”‚
  â”‚ - æ‰§è¡Œå¼€å‘ä»»åŠ¡      â”‚
  â”‚ - ç›´æ¥æäº¤åˆ° PR     â”‚
  â”‚ - å…³é—­ Sub-Issue    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ (æ¯ä¸ª Sub-Issue å…³é—­æ—¶)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å·¥ä½œæµ 3: ç›‘æ§å™¨     â”‚
  â”‚ - æ£€æŸ¥å®ŒæˆçŠ¶æ€      â”‚
  â”‚ - æœªå®Œæˆ: æ›´æ–°è¿›åº¦   â”‚
  â”‚ - å…¨å®Œæˆ: @ç”¨æˆ·å®¡æŸ¥  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¿«é€Ÿå‚è€ƒè¡¨

| è§¦å‘å™¨ç±»å‹ | è¯­æ³•ç¤ºä¾‹ | ç”¨é€” |
|-----------|---------|------|
| Issue åˆ›å»º | `on: issues: types: [opened]` | Issue è‡ªåŠ¨åŒ– |
| PR åˆ›å»º | `on: pull_request: types: [opened]` | PR è‡ªåŠ¨åŒ– |
| Slash å‘½ä»¤ | `on: slash_command: name: bot` | èŠå¤©æœºå™¨äºº |
| å®šæ—¶æ‰§è¡Œ | `on: schedule: - cron: "0 9 * * 1"` | å®šæœŸä»»åŠ¡ |
| æ¨¡ç³Šå®šæ—¶ | `on: schedule: daily` | åˆ†æ•£è´Ÿè½½ |
| æ‰‹åŠ¨è§¦å‘ | `on: workflow_dispatch:` | æµ‹è¯•/è°ƒè¯• |
| æ ‡ç­¾è§¦å‘ | `on: issue labeled bug` | æ ‡ç­¾è‡ªåŠ¨åŒ– |
| å·¥ä½œæµç›‘æ§ | `on: workflow_run: workflows: [CI]` | CI å¤±è´¥å“åº” |
| å¤ç”¨å·¥ä½œæµ | `on: workflow_call:` | æ¨¡å—åŒ–å·¥ä½œæµ |

---

## ç›¸å…³æ–‡æ¡£

- [å®˜æ–¹æŒ‡å¼•.md](å®˜æ–¹æŒ‡å¼•.md) - å®Œæ•´ Frontmatter Schema
- [WORKFLOW-INDEX.md](WORKFLOW-INDEX.md) - å·¥ä½œæµæ¨¡æ¿ç´¢å¼•
- [CAPABILITY-BOUNDARIES.md](CAPABILITY-BOUNDARIES.md) - èƒ½åŠ›è¾¹ç•Œ
