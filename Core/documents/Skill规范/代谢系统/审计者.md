# 审计者（Auditor）

审计者是代谢系统中的提炼主体，负责从行为痕迹中提取有价值的信号。

## 角色定位

```
┌─────────────────────────────────────────────────────────────┐
│                         审计者                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   输入                    处理                    输出       │
│   ────                    ────                    ────      │
│   GitHub Actions    识别失败/回退/犹豫模式       信号        │
│   日志                    ↓                    (Issues)     │
│                      归因到具体 Skill                       │
│   重构日志                ↓                                 │
│                      生成/更新 Issue                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 核心职责

### 1. 读取行为痕迹

审计者从 GitHub Actions 日志中读取创建者的行为痕迹：

```bash
# 获取最近的工作流运行
gh run list --limit 10

# 查看具体运行的日志
gh run view <run-id> --log
```

### 2. 识别问题模式

从痕迹中识别以下模式：

| 模式 | 痕迹特征 | 信号类型 |
|------|----------|----------|
| 失败 | 任务未完成、错误信息 | 视原因定 |
| 回退 | 使用 A 后改用 B | `unclear` 或 `outdated` |
| 犹豫 | 在多个 Skill 间切换 | `unclear` |
| 空缺 | 搜索无果、手动实现 | `missing` |
| 冗余 | 加载 Skill 但未使用 | `unused` |
| 过载 | 在一个 Skill 中搜索很久 | `overload` |

### 3. 归因到 Skill

将识别的问题归因到具体的 Skill 节点：

```markdown
## 归因原则

1. **直接归因**：日志中明确提到的 Skill
   - "读取 verseDev/verseComponent/SKILL.md"
   - "verseComponent 的示例无法运行"

2. **推断归因**：根据任务类型推断应该使用的 Skill
   - 任务是"创建组件" → 应该用 verseComponent
   - 但日志显示用户手动写了组件 → verseComponent 可能有问题

3. **层级归因**：问题可能在父节点或子节点
   - 找不到具体的子 Skill → 归因到父 Skill 的 Children 章节
   - 父 Skill 的描述不清 → 归因到父 Skill 的 When to Use
```

### 4. 生成/更新信号

将分析结果写入信号池（GitHub Issues）：

#### 新建信号

```markdown
Title: [outdated] verseDev/verseComponent
Labels: signal, outdated

## 信号记录

**Target**: verseDev/verseComponent
**Type**: outdated
**Source**: actions/run-12345

### Evidence

1. **2026-01-02** via actions/run-12345
   用户尝试使用 verseComponent 的示例代码，
   但在 UEFN 5.x 中编译失败，错误信息：
   "Unknown identifier: component_base"
   
   推断：示例代码引用了已废弃的 API
```

#### 更新已有信号

在已有 Issue 中添加 Comment：

```markdown
### 新增 Evidence

**2026-01-03** via actions/run-12350

又一次遇到同样的问题，这次是另一个用户。
错误相同："Unknown identifier: component_base"

Count: 2 → 3
```

### 5. 学习重构结果

审计者还应该读取重构日志，学习：

```markdown
## 从重构日志学习

1. 哪些信号归因是准确的？
   - 重构后问题消失 → 归因正确
   - 重构后问题依旧 → 可能归因错误

2. 哪些模式识别需要调整？
   - 某类问题总是被误判 → 调整识别规则

3. 有没有遗漏的信号类型？
   - 重构者发现了审计者没注意到的问题 → 补充识别模式
```

## 审计触发

### 触发条件

| 触发类型 | 条件 | 说明 |
|----------|------|------|
| 任务触发 | 工作流失败 | 失败时立即审计 |
| 批量触发 | 积累 N 次运行 | 定期批量分析 |
| 定时触发 | 每天/每周 | 常规审计 |
| 手动触发 | 人工请求 | 特定分析 |

### GitHub Actions 集成

```yaml
# .github/workflows/auditor.yml
name: Skill Auditor

on:
  workflow_run:
    workflows: ["*"]
    types: [completed]
  schedule:
    - cron: '0 0 * * *'  # 每天审计
  workflow_dispatch:

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - name: Collect recent logs
        run: |
          # 收集最近的运行日志
          
      - name: Analyze patterns
        run: |
          # 分析问题模式
          
      - name: Generate signals
        run: |
          # 创建/更新 Issues
```

## 审计报告

每次审计可以生成报告摘要：

```markdown
# 审计报告 - 2026-01-02

## 分析范围

- 时间：2026-01-01 ~ 2026-01-02
- 工作流运行数：15
- 失败数：3

## 新增信号

| Target | Type | Count | 详情 |
|--------|------|-------|------|
| verseDev/verseComponent | outdated | 2 | 示例代码过时 |
| verseDev | missing | 1 | 缺少网络同步 |

## 更新信号

| Issue | Type | Count 变化 |
|-------|------|-----------|
| #42 | unclear | 3 → 4 |

## 待观察

- verseHelpers 被频繁读取但使用率低，可能需要优化入口
```

## 实现位置

审计者 Skill 应实现在：

```
Core/skills/programming/skillAuditor/
├── SKILL.md
└── checklists/
    └── pattern-recognition.md  # 模式识别检查清单
```

---

**相关文档**：
- [代谢主体](代谢主体.md)
- [信号机制](信号机制.md)
- [创建者](创建者.md)
- [重构者](重构者.md)
- [调度规则](调度规则.md)
